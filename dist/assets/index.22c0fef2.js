import{p as D,q as Pe}from"./vendor-lark.9e248cc2.js";import{j as Me,$ as e}from"./vendor-jquery.88f4ff12.js";import{i as s,B as Ue}from"./vendor-i18n.7cd67a60.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))p(l);new MutationObserver(l=>{for(const g of l)if(g.type==="childList")for(const x of g.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&p(x)}).observe(document,{childList:!0,subtree:!0});function r(l){const g={};return l.integrity&&(g.integrity=l.integrity),l.referrerpolicy&&(g.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?g.credentials="include":l.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function p(l){if(l.ep)return;l.ep=!0;const g=r(l);fetch(l.href,g)}})();const ze="\u5C0F\u7EA2\u4E66\u535A\u4E3B\u7B14\u8BB0\u83B7\u53D6",Ne="\u4E00\u952E\u5F0F\u83B7\u53D6\u5C0F\u7EA2\u4E66\u535A\u4E3B\u7684\u7B14\u8BB0\u6570\u636E,\u5305\u62EC\u539F\u56FE/\u89C6\u9891/\u89C6\u9891\u6587\u672C",Oe={user:"\u7528\u6237",userName:"\u7528\u6237\u540D",userId:"\u7528\u6237ID",vipLevel:"VIP\u7B49\u7EA7",remainDownloads:"\u53EF\u4E0B\u8F7D\u6B21\u6570",boundTables:"\u5DF2\u7ED1\u5B9A\u8868\u683C",expireTime:"\u5230\u671F\u65F6\u95F4",normalUser:"\u666E\u901A\u7528\u6237",membershipExpired:"\u4F1A\u5458\u5DF2\u8FC7\u671F"},je={title:"\u5DF2\u7ED1\u5B9A\u8868\u683C\u5217\u8868",empty:"\u6682\u65E0\u5DF2\u7ED1\u5B9A\u7684\u8868\u683C",tableName:"\u8868\u683C\u540D\u79F0",tableId:"\u8868\u683CID",xhsBinding:"\u535A\u4E3B\u5C0F\u7EA2\u4E66\u53F7\u7ED1\u5B9A",remark:"\u5907\u6CE8",bound:"\u5DF2\u7ED1\u5B9A",notBound:"\u672A\u7ED1\u5B9A",openTable:"\u6253\u5F00\u8868\u683C"},Re={title:"\u6570\u636E\u8868\u7BA1\u7406",noTables:"\u6682\u65E0\u6570\u636E\u8868",tableId:"Table ID",xhsId:"\u5C0F\u7EA2\u4E66\u7ED1\u5B9AID",notBound:"\u672A\u7ED1\u5B9A",remark:"\u5907\u6CE8",bound:"\u5DF2\u7ED1\u5B9A",unbound:"\u672A\u7ED1\u5B9A"},He={existingTables:"\u73B0\u6709\u8868\u683C",newTable:"\u65B0\u5EFA\u8868\u683C"},Xe={tableName:"\u8868\u683C\u540D\u79F0",tableDesc:"\u8868\u683C\u63CF\u8FF0(\u53EF\u9009)",previewTitle:"\u5C06\u81EA\u52A8\u521B\u5EFA\u4EE5\u4E0B\u5B57\u6BB5"},_e={selectTable:"\u9009\u62E9\u8868\u683C",pleaseSelect:"\u8BF7\u9009\u62E9\u8868\u683C",tableName:"\u8868\u683C\u540D\u79F0",tableId:"Table ID",xhsId:"\u5C0F\u7EA2\u4E66ID",remark:"\u5907\u6CE8",bound:"\u5DF2\u8BBE\u7F6E",notBound:"\u672A\u8BBE\u7F6E\u81EA\u52A8\u63A8\u9001"},Ge={bindTitle:"\u63A8\u9001\u8BBE\u7F6E",editTitle:"\u4FEE\u6539\u81EA\u52A8\u63A8\u9001\u8BBE\u7F6E",tableName:"\u8868\u683C\u540D\u79F0",personalBaseToken:"Personal Base Token",personalBaseTokenHint:"\u6BCF\u4E2A\u591A\u7EF4\u8868\u683C\u4E00\u4E2A\u552F\u4E00\u6807\u8BC6",xhsUrl:"\u5C0F\u7EA2\u4E66\u7ED1\u5B9A(\u7ED1\u5B9A\u540E\u652F\u6301\u624B\u673A\u5BA2\u6237\u7AEF\u63A8\u9001)",xhsUrlHint:"\u652F\u6301 xiaohongshu.com \u6216 xhslink.com \u94FE\u63A5\uFF0C\u6216\u76F4\u63A5\u8F93\u516524\u4F4D\u5C0F\u7EA2\u4E66ID",remark:"\u5907\u6CE8\uFF08\u53EF\u9009\uFF09",fieldSelection:"\u5B57\u6BB5\u9009\u62E9",fieldSelectionHint:"\u9009\u62E9\u9700\u8981\u91C7\u96C6\u7684\u5B57\u6BB5\uFF0C\u672A\u9009\u62E9\u7684\u5B57\u6BB5\u5C06\u4E0D\u4F1A\u88AB\u586B\u5145\u6570\u636E",selectAll:"\u5168\u9009",deselectAll:"\u6E05\u7A7A",extractedInfo:"\u63D0\u53D6\u4FE1\u606F",appToken:"App Token",tableId:"Table ID",xhsId:"XHS ID"},Ve={refresh:"\u5237\u65B0",activate:"\u5F00\u901A",renew:"\u7EED\u8D39",bind:"\u63A8\u9001\u8BBE\u7F6E",edit:"\u4FEE\u6539\u8BBE\u7F6E",unbind:"\u89E3\u9664\u8BBE\u7F6E",save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",close:"\u5173\u95ED",chatGroup:"\u4EA4\u6D41\u7FA4",support:"\u6280\u672F\u652F\u6301",createTable:"\u521B\u5EFA\u8868\u683C",startProcessing:"\u5F00\u59CB\u83B7\u53D6\u535A\u4E3B\u7B14\u8BB0",help:"\u5E2E\u52A9"},We={saving:"\u6B63\u5728\u4FDD\u5B58...",saveSuccess:"\u4FDD\u5B58\u6210\u529F",saveFailed:"\u4FDD\u5B58\u5931\u8D25",fieldSelectionSaved:"\u9ED8\u8BA4\u5B57\u6BB5\u9009\u62E9\u5DF2\u4FDD\u5B58",unbinding:"\u6B63\u5728\u89E3\u9664\u7ED1\u5B9A...",unbindSuccess:"\u89E3\u9664\u7ED1\u5B9A\u6210\u529F",unbindFailed:"\u89E3\u9664\u7ED1\u5B9A\u5931\u8D25",confirmUnbind:"\u89E3\u9664\u7ED1\u5B9A\u540E\u5C06\u4E0D\u80FD\u6536\u5230\u63A8\u9001\u6D88\u606F\uFF0C\u786E\u8BA4\u8981\u89E3\u9664\u8BE5\u8868\u683C\u7684\u7ED1\u5B9A\u5417\uFF1F",pleaseLoginFirst:"\u8BF7\u5148\u91CD\u65B0\u767B\u5F55\u83B7\u53D6\u6388\u6743",cannotGetBaseInfo:"\u65E0\u6CD5\u83B7\u53D6Base\u4FE1\u606F",openModalFailed:"\u6253\u5F00\u7ED1\u5B9A\u7A97\u53E3\u5931\u8D25",invalidUrl:"\u65E0\u6548\u7684\u94FE\u63A5",pleaseInputPersonalBaseToken:"\u8BF7\u8F93\u5165Personal Base Token",pleaseInputXhsUrl:"\u8BF7\u8F93\u5165\u5C0F\u7EA2\u4E66\u4E3B\u9875\u94FE\u63A5",extractXhsIdFailed:"\u63D0\u53D6\u5C0F\u7EA2\u4E66ID\u5931\u8D25",refreshingUserInfo:"\u6B63\u5728\u5237\u65B0\u7528\u6237\u4FE1\u606F...",userInfoRefreshSuccess:"\u7528\u6237\u4FE1\u606F\u5237\u65B0\u6210\u529F",refreshFailed:"\u5237\u65B0\u5931\u8D25",authorizationExpired:"\u6388\u6743\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55",unknownError:"\u672A\u77E5\u9519\u8BEF",pleaseSelectTableFirst:"\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8868\u683C",loadTableListFailed:"\u52A0\u8F7D\u8868\u683C\u5217\u8868\u5931\u8D25",updating:"\u6B63\u5728\u66F4\u65B0...",updateSuccess:"\u66F4\u65B0\u6210\u529F",updateFailed:"\u66F4\u65B0\u5931\u8D25",authFailed:"\u83B7\u53D6\u6388\u6743\u94FE\u63A5\u5931\u8D25",authSuccess:"\u767B\u5F55\u6210\u529F\uFF01",authTimeout:"\u6388\u6743\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5"},Ke={failed:"\u6388\u6743\u5931\u8D25",failedMessage:"\u65E0\u6CD5\u9A8C\u8BC1\u60A8\u7684\u6388\u6743\u4FE1\u606F\uFF0C\u8BF7\u5C06\u4EE5\u4E0B\u4FE1\u606F\u63D0\u4F9B\u7ED9\u7BA1\u7406\u5458",tenantKey:"\u79DF\u6237\u5BC6\u94A5",needLogin:"\u9700\u8981\u767B\u5F55",needLoginMessage:"\u4F7F\u7528\u524D\u8BF7\u5148\u767B\u5F55\u4EE5\u83B7\u5F97\u5B8C\u6574\u4F53\u9A8C",feishuLogin:"\u98DE\u4E66\u6388\u6743\u767B\u5F55",loading:"\u52A0\u8F7D\u4E2D...",modalTitle:"\u98DE\u4E66\u6388\u6743\u767B\u5F55",modalMessage:"\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u6253\u5F00\u98DE\u4E66\u6388\u6743\u9875\u9762",step1:"1. \u70B9\u51FB\u6309\u94AE\u6253\u5F00\u98DE\u4E66\u6388\u6743\u9875\u9762",step2:"2. \u5B8C\u6210\u6388\u6743\u540E\u5C06\u81EA\u52A8\u8FD4\u56DE",waitingAuth:"\u7B49\u5F85\u6388\u6743\u4E2D...",cancel:"\u53D6\u6D88",openAuthPage:"\u6253\u5F00\u6388\u6743\u9875\u9762",opened:"\u5DF2\u6253\u5F00",notLoggedIn:"\u672A\u767B\u5F55",login:"\u767B\u5F55"},qe={verifying:"\u6B63\u5728\u9A8C\u8BC1\u6388\u6743..."},Je={hint:"\u5C06\u81EA\u52A8\u83B7\u53D6\u535A\u4E3B\u7684\u6240\u6709\u7B14\u8BB0\u5E76\u6DFB\u52A0\u5230\u8868\u683C"},Qe={title:"\u514D\u8D23\u58F0\u660E",content:`1. \u672C\u63D2\u4EF6\u4EC5\u7528\u4E8E\u4E2A\u4EBA\u5B66\u4E60\u548C\u7814\u7A76\u76EE\u7684,\u4E0D\u5F97\u7528\u4E8E\u4EFB\u4F55\u5546\u4E1A\u7528\u9014\u3002
2. \u7528\u6237\u4F7F\u7528\u672C\u63D2\u4EF6\u91C7\u96C6\u7684\u6570\u636E,\u5E94\u9075\u5B88\u5C0F\u7EA2\u4E66\u5E73\u53F0\u7684\u76F8\u5173\u89C4\u5B9A\u548C\u7528\u6237\u534F\u8BAE\u3002
3. \u672C\u63D2\u4EF6\u4E0D\u5BF9\u91C7\u96C6\u5185\u5BB9\u7684\u51C6\u786E\u6027\u3001\u5B8C\u6574\u6027\u548C\u53CA\u65F6\u6027\u627F\u62C5\u8D23\u4EFB\u3002
4. \u7528\u6237\u5E94\u59A5\u5584\u4FDD\u7BA1\u8D26\u53F7\u4FE1\u606F,\u56E0\u8D26\u53F7\u6CC4\u9732\u9020\u6210\u7684\u635F\u5931\u7531\u7528\u6237\u81EA\u884C\u627F\u62C5\u3002
5. \u672C\u63D2\u4EF6\u5C0A\u91CD\u7B2C\u4E09\u65B9\u77E5\u8BC6\u4EA7\u6743,\u5982\u6D89\u53CA\u4FB5\u6743\u8BF7\u8054\u7CFB\u5220\u9664\u3002
6. \u4F7F\u7528\u672C\u63D2\u4EF6\u5373\u8868\u793A\u60A8\u540C\u610F\u672C\u58F0\u660E\u7684\u6240\u6709\u6761\u6B3E,\u5982\u6709\u5F02\u8BAE\u8BF7\u7ACB\u5373\u505C\u6B62\u4F7F\u7528\u3002`},Ye={title:"\u5145\u503C\u5957\u9910",loading:"\u52A0\u8F7D\u4E2D...",loadFailed:"\u52A0\u8F7D\u5931\u8D25",selectPackage:"\u8BF7\u9009\u62E9\u5145\u503C\u5957\u9910",vip:"VIP",points:"\u79EF\u5206",days:"\u5929",discount:"\u4F18\u60E0",originalPrice:"\u539F\u4EF7",currentPrice:"\u73B0\u4EF7",paymentMethod:"\u652F\u4ED8\u65B9\u5F0F",alipay:"\u652F\u4ED8\u5B9D",wechat:"\u5FAE\u4FE1\u652F\u4ED8",submitOrder:"\u63D0\u4EA4\u8BA2\u5355",scanToPay:"\u8BF7\u4F7F\u7528\u624B\u673A\u626B\u7801\u652F\u4ED8",scanWithAlipay:"\u8BF7\u4F7F\u7528\u652F\u4ED8\u5B9D\u626B\u7801",scanWithWechat:"\u8BF7\u4F7F\u7528\u5FAE\u4FE1\u626B\u7801",qrExpired:"\u4E8C\u7EF4\u7801\u5DF2\u5931\u6548",expiresIn:"\u4E8C\u7EF4\u7801\u5C06\u5728 {minutes} \u5206 {seconds} \u79D2\u540E\u5931\u6548",orderId:"\u8BA2\u5355\u53F7",creatingOrder:"\u6B63\u5728\u521B\u5EFA\u8BA2\u5355...",orderCreated:"\u8BA2\u5355\u521B\u5EFA\u6210\u529F",orderFailed:"\u8BA2\u5355\u521B\u5EFA\u5931\u8D25",paymentFailed:"\u652F\u4ED8\u5931\u8D25",highlightTitle:"\u4E00\u952E\u83B7\u53D6\u7B14\u8BB0\u8BE6\u60C5",highlight1:"\u65E0\u8BBA\u89C6\u9891\u591A\u957F\u5B9E\u65F6\u83B7\u53D6\u89C6\u9891\u6587\u6848",highlight2:"\u8282\u7701\u65F6\u95F4\uFF0C\u63D0\u5347\u6548\u7387",highlight3:"\u65E0\u9700\u642D\u914D\u5176\u4ED6\u4ED8\u8D39\u89C6\u9891\u8F6C\u6587\u5B57\u63D2\u4EF6",highlight4:"\u6279\u91CF\u5904\u7406\uFF0C\u4E00\u952E\u91C7\u96C6",highlight5:"\u65E0\u9700\u5B89\u88C5\u63D2\u4EF6\u5B9E\u73B0\u5C0F\u7EA2\u4E66app\u76F4\u63A5\u63A8\u9001\u5230\u98DE\u4E66\u591A\u7EF4\u8868\u683C",limitedTimeOffer:"\u9650\u65F6\u4F18\u60E0\uFF0C\u8DDD\u7ED3\u675F\u4EC5\u5269\uFF1A"},Ze={title:"\u63A8\u9001\u8BBE\u7F6E",add:"\u6DFB\u52A0",empty:"\u6682\u65E0\u63A8\u9001\u8BBE\u7F6E\uFF0C\u70B9\u51FB\u6DFB\u52A0\u6309\u94AE\u521B\u5EFA",blogger:"\u535A\u4E3B",bloggerId:"\u535A\u4E3BID",scheduleTime:"\u5B9A\u65F6\u65F6\u95F4",lastUpdateTime:"\u4E0A\u6B21\u66F4\u65B0",status:"\u72B6\u6001",enabled:"\u5DF2\u542F\u7528",disabled:"\u5DF2\u7981\u7528",operations:"\u64CD\u4F5C",edit:"\u7F16\u8F91",delete:"\u5220\u9664",enable:"\u542F\u7528",disable:"\u7981\u7528",confirmDelete:"\u786E\u8BA4\u5220\u9664\u6B64\u63A8\u9001\u8BBE\u7F6E\uFF1F",modal:{title:"\u6DFB\u52A0\u63A8\u9001\u8BBE\u7F6E",editTitle:"\u7F16\u8F91\u63A8\u9001\u8BBE\u7F6E",selectTable:"\u9009\u62E9\u63A8\u9001\u8868\u683C",personalBaseToken:"Personal Base Token",personalBaseTokenHint:"\u7528\u4E8E\u5199\u5165\u7B14\u8BB0\u5230\u8868\u683C\u7684\u6743\u9650\u4EE4\u724C",personalBaseTokenHelp:"\u5982\u4F55\u83B7\u53D6: \u6253\u5F00\u98DE\u4E66\u591A\u7EF4\u8868\u683C \u2192 \u70B9\u51FB\u53F3\u4E0A\u89D2... \u2192 \u9009\u62E9\u5F00\u53D1\u8005\u9009\u9879 \u2192 \u590D\u5236Personal Base Token",bloggerUrl:"\u535A\u4E3B\u94FE\u63A5",bloggerUrlHint:"\u652F\u6301 xiaohongshu.com \u6216 xhslink.com \u94FE\u63A5\uFF0C\u6216\u76F4\u63A5\u8F93\u516524\u4F4D\u5C0F\u7EA2\u4E66ID",bloggerNickname:"\u535A\u4E3B\u6635\u79F0",timeConfigType:"\u65F6\u95F4\u914D\u7F6E\u7C7B\u578B",timeTypeFixed:"\u56FA\u5B9A\u65F6\u95F4\u70B9",timeTypeInterval:"\u95F4\u9694\u65F6\u95F4",timeTypeCron:"Cron\u8868\u8FBE\u5F0F",checkTime:"\u68C0\u6D4B\u65F6\u95F4",checkTimeFixedHint:"\u70B9\u51FB\u4E0B\u65B9\u6309\u94AE\u6DFB\u52A0\u65F6\u95F4\u70B9",checkTimeIntervalHint:"\u95F4\u9694\u5206\u949F\u6570\uFF0C\u5982\uFF1A30\uFF08\u6BCF30\u5206\u949F\uFF09",checkTimeCronHint:"Cron\u8868\u8FBE\u5F0F\uFF0C\u5982\uFF1A0 0 9 * * ?\uFF08\u6BCF\u5929\u4E0A\u53489\u70B9\uFF09",intervalUnit:"\u5355\u4F4D\uFF1A\u5206\u949F\uFF08\u6BCF\u9694N\u5206\u949F\u68C0\u6D4B\u4E00\u6B21\uFF09",openTable:"\u6253\u5F00\u8868\u683C",enableRandomDelay:"\u542F\u7528\u968F\u673A\u5EF6\u8FDF",randomDelayMin:"\u6700\u5C0F\u5EF6\u8FDF\uFF08\u79D2\uFF09",randomDelayMax:"\u6700\u5927\u5EF6\u8FDF\uFF08\u79D2\uFF09",isEnabled:"\u542F\u7528\u6B64\u63A8\u9001\u8BBE\u7F6E",addTimePoint:"+ \u6DFB\u52A0\u65F6\u95F4\u70B9",timeType:{fixed:"\u56FA\u5B9A\u65F6\u95F4\u70B9",interval:"\u95F4\u9694",cron:"Cron"},usageTitle:"\u4E0B\u8F7D\u6B21\u6570\u8BF4\u660E\uFF1A",usagePoint1:"\u6BCF\u68C0\u6D4B1\u6B21\u6D88\u80171\u6B21\u4E0B\u8F7D\u6B21\u6570\uFF08\u65E0\u8BBA\u662F\u5426\u6709\u7B14\u8BB0\uFF09",usagePoint2:"\u6BCF\u83B7\u53D61\u7BC7\u7B14\u8BB0\u6D88\u80171\u6B21\u4E0B\u8F7D\u6B21\u6570\uFF08\u4F8B\uFF1A\u67D0\u65F6\u523B\u68C0\u6D4B\u52303\u7BC7\u65B0\u7B14\u8BB0\uFF0C\u5C06\u6D88\u80174\u6B21\u4E0B\u8F7D\u6B21\u6570\uFF09",usagePoint3:"\u9ED8\u8BA4\u83B7\u53D6\u5F53\u524D\u65F6\u95F4\u4EE5\u540E\u7684\u7B14\u8BB0"}},et={title:ze,subtitle:Ne,userInfo:Oe,boundTablesList:je,tableList:Re,tabs:He,newTable:Xe,existingTable:_e,modal:Ge,buttons:Ve,messages:We,auth:Ke,loading:qe,processing:Je,disclaimer:Qe,recharge:Ye,pushSettings:Ze},tt="Xiaohongshu Blogger Notes Extraction",nt="One-click access to Xiaohongshu blogger notes data, including original images/videos/video text",ot={user:"User",userName:"Username",userId:"User ID",vipLevel:"VIP Level",remainDownloads:"Remaining Downloads",boundTables:"Bound Tables",expireTime:"Expire Time",normalUser:"Normal User",membershipExpired:"Membership Expired"},at={title:"Bound Tables List",empty:"No bound tables",tableName:"Table Name",tableId:"Table ID",xhsBinding:"XHS Account Binding",remark:"Remark",bound:"Bound",notBound:"Not Bound",openTable:"Open Table"},st={title:"Data Table Management",noTables:"No tables available",tableId:"Table ID",xhsId:"Xiaohongshu Binding ID",notBound:"Not Bound",remark:"Remark",bound:"Bound",unbound:"Unbound"},it={existingTables:"Existing Tables",newTable:"New Table"},rt={tableName:"Table Name",tableDesc:"Table Description (Optional)",previewTitle:"The following fields will be created automatically"},lt={selectTable:"Select Table",pleaseSelect:"Please select a table",tableName:"Table Name",tableId:"Table ID",xhsId:"Xiaohongshu ID",remark:"Remark",bound:"Configured",notBound:"Auto Push Not Configured"},ut={bindTitle:"Push Settings",editTitle:"Edit Auto Push Settings",tableName:"Table Name",personalBaseToken:"Personal Base Token",personalBaseTokenHint:"Unique identifier for each base table",xhsUrl:"Xiaohongshu Binding (Supports mobile push notifications after binding)",xhsUrlHint:"Supports xiaohongshu.com or xhslink.com URLs, or directly input 24-character XHS ID",remark:"Remark (Optional)",fieldSelection:"Field Selection",fieldSelectionHint:"Select fields to collect. Unselected fields will not be populated with data.",selectAll:"Select All",deselectAll:"Clear All",extractedInfo:"Extracted Information",appToken:"App Token",tableId:"Table ID",xhsId:"XHS ID"},dt={refresh:"Refresh",activate:"Activate",renew:"Renew",bind:"Push Settings",edit:"Edit Settings",unbind:"Remove Settings",save:"Save",cancel:"Cancel",close:"Close",chatGroup:"Chat Group",support:"Support",createTable:"Create Table",startProcessing:"Start Fetching Blogger Notes",help:"Help"},ct={saving:"Saving...",saveSuccess:"Saved successfully",saveFailed:"Save failed",fieldSelectionSaved:"Default field selection saved",unbinding:"Unbinding...",unbindSuccess:"Unbound successfully",unbindFailed:"Unbind failed",confirmUnbind:"After unbinding, you will not receive push messages. Are you sure you want to unbind this table?",pleaseLoginFirst:"Please re-login to get authorization",cannotGetBaseInfo:"Cannot get base information",openModalFailed:"Failed to open binding dialog",invalidUrl:"Invalid URL",pleaseInputPersonalBaseToken:"Please input Personal Base Token",pleaseInputXhsUrl:"Please input Xiaohongshu homepage URL",extractXhsIdFailed:"Failed to extract XHS ID",refreshingUserInfo:"Refreshing user information...",userInfoRefreshSuccess:"User information refreshed successfully",refreshFailed:"Refresh failed",authorizationExpired:"Authorization has expired, please re-login",unknownError:"Unknown error",pleaseSelectTableFirst:"Please select a table first",loadTableListFailed:"Failed to load table list",updating:"Updating...",updateSuccess:"Updated successfully",updateFailed:"Update failed",authFailed:"Failed to get authorization link",authSuccess:"Login successful!",authTimeout:"Authorization timeout, please try again"},pt={failed:"Authorization Failed",failedMessage:"Unable to verify your authorization information. Please provide the following information to the administrator",tenantKey:"Tenant Key",needLogin:"Login Required",needLoginMessage:"Please login first for full experience",feishuLogin:"Feishu Auth Login",loading:"Loading...",modalTitle:"Feishu Authorization",modalMessage:"Click the button below to open Feishu authorization page",step1:"1. Click button to open Feishu authorization page",step2:"2. You will be redirected after authorization",waitingAuth:"Waiting for authorization...",cancel:"Cancel",openAuthPage:"Open Authorization Page",opened:"Opened",notLoggedIn:"Not Logged In",login:"Login"},ht={verifying:"Verifying authorization..."},gt={hint:"Automatically fetch all blogger notes and add to table"},ft={title:"Disclaimer",content:`1. This plugin is for personal learning and research purposes only, not for any commercial use.
2. Users using this plugin to collect data should comply with Xiaohongshu platform's relevant regulations and user agreements.
3. This plugin is not responsible for the accuracy, completeness, and timeliness of collected content.
4. Users should properly safeguard account information, and losses caused by account leaks shall be borne by the users themselves.
5. This plugin respects third-party intellectual property rights, please contact for removal if involved in infringement.
6. Using this plugin indicates that you agree to all terms of this statement, please stop using immediately if you have any objections.`},mt={title:"Recharge Packages",loading:"Loading...",loadFailed:"Failed to load",selectPackage:"Please select a package",vip:"VIP",points:"Points",days:"days",discount:"Discount",originalPrice:"Original Price",currentPrice:"Current Price",paymentMethod:"Payment Method",alipay:"Alipay",wechat:"WeChat Pay",submitOrder:"Submit Order",scanToPay:"Please scan to pay with mobile",scanWithAlipay:"Please scan with Alipay",scanWithWechat:"Please scan with WeChat",qrExpired:"QR code expired",expiresIn:"QR code expires in {minutes} min {seconds} sec",orderId:"Order ID",creatingOrder:"Creating order...",orderCreated:"Order created successfully",orderFailed:"Failed to create order",paymentFailed:"Payment failed",highlightTitle:"One-Click Note Extraction",highlight1:"Real-time video text extraction regardless of video length",highlight2:"Save time, boost efficiency",highlight3:"No need for other paid video-to-text plugins",highlight4:"Batch processing, one-click collection",highlight5:"No plugin needed - direct push from Xiaohongshu app to Feishu base tables",limitedTimeOffer:"Limited time offer, ends in:"},bt={title:"Push Settings",add:"Add",empty:"No push settings yet. Click 'Add' to create one",blogger:"Blogger",bloggerId:"Blogger ID",scheduleTime:"Schedule",lastUpdateTime:"Last Update",status:"Status",enabled:"Enabled",disabled:"Disabled",operations:"Operations",edit:"Edit",delete:"Delete",enable:"Enable",disable:"Disable",confirmDelete:"Are you sure to delete this push setting?",modal:{title:"Add Push Setting",editTitle:"Edit Push Setting",selectTable:"Select Target Table",personalBaseToken:"Personal Base Token",personalBaseTokenHint:"Permission token for writing notes to table",personalBaseTokenHelp:"How to get: Open Feishu Base \u2192 Click '...' in top right \u2192 Select 'Developer Options' \u2192 Copy Personal Base Token",bloggerUrl:"Blogger URL",bloggerUrlHint:"Supports xiaohongshu.com or xhslink.com URLs, or directly input 24-character XHS ID",bloggerNickname:"Blogger Nickname",timeConfigType:"Time Configuration Type",timeTypeFixed:"Fixed Time Points",timeTypeInterval:"Interval",timeTypeCron:"Cron Expression",checkTime:"Check Time",checkTimeFixedHint:"Click button below to add time points",checkTimeIntervalHint:"Interval minutes, e.g.: 30 (every 30 minutes)",checkTimeCronHint:"Cron expression, e.g.: 0 0 9 * * ? (daily at 9 AM)",intervalUnit:"Unit: minutes (check every N minutes)",openTable:"Open Table",enableRandomDelay:"Enable Random Delay",randomDelayMin:"Min Delay (seconds)",randomDelayMax:"Max Delay (seconds)",isEnabled:"Enable this push setting",addTimePoint:"+ Add Time Point",timeType:{fixed:"Fixed",interval:"Interval",cron:"Cron"},usageTitle:"Download Count Usage:",usagePoint1:"Each check consumes 1 download count (whether or not there are notes)",usagePoint2:"Each note retrieved consumes 1 download count (e.g., if 3 new notes detected, will consume 4 download counts)",usagePoint3:"By default retrieves notes after current time"}},yt={title:tt,subtitle:nt,userInfo:ot,boundTablesList:at,tableList:st,tabs:it,newTable:rt,existingTable:lt,modal:ut,buttons:dt,messages:ct,auth:pt,loading:ht,processing:gt,disclaimer:ft,recharge:mt,pushSettings:bt};s.use(Ue).init({resources:{zh:{translation:et},en:{translation:yt}},fallbackLng:"zh",debug:!1,interpolation:{escapeValue:!1}}).then(()=>{Me.init(s,e,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"i18n-target",optionsAttr:"i18n-options",parseOptionsFromContent:!0}),ce()});function ce(){e("[data-i18n]").localize(),document.title=s.t("title"),document.documentElement.lang=s.language}const xt={info:'<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',success:'<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',warning:'<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',error:'<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',loading:'<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>'};function u(o,a="info",r){const p=document.getElementById("toastContainer");if(!p)return;r&&r.parentNode&&r.parentNode.removeChild(r);const l=document.createElement("div");return l.className=`toast ${a}`,l.innerHTML=`
    <div class="toast-icon">${xt[a]}</div>
    <div class="toast-message">${o}</div>
  `,p.appendChild(l),a!=="loading"&&setTimeout(()=>{l.classList.add("hiding"),setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},300)},3e3),l}function wt(){const o=document.getElementById("loadingOverlay");o&&o.classList.add("active")}function ge(){const o=document.getElementById("loadingOverlay");o&&o.classList.remove("active")}function ye(o){localStorage.setItem("xhsnote_token",o)}function j(){return localStorage.getItem("xhsnote_token")}function K(o){localStorage.setItem("xhsnote_user_info",JSON.stringify(o))}function xe(){const o=localStorage.getItem("xhsnote_user_info");if(o)try{return JSON.parse(o)}catch(a){console.error("Failed to parse saved user info:",a)}return null}async function W(o){e("#userId").text(o.userId||"-"),o.remainDownload!==void 0&&o.remainDownload!==null?(e("#remainDownload").text(o.remainDownload),o.remainDownload<=0?e("#remainDownload").css("color","#ff4d4f"):o.remainDownload<10?e("#remainDownload").css("color","#faad14"):e("#remainDownload").css("color","#52c41a")):e("#remainDownload").text("-");try{const a=j();if(a){const r=await fetch("https://shop.leshangyundian.com/feishu/api/table/list",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(r.ok){const p=await r.json(),l=p.data||p,g=Array.isArray(l)?l.length:0;e("#boundTableCount").text(g)}else e("#boundTableCount").text("-")}else e("#boundTableCount").text("-")}catch(a){console.error("Failed to fetch bound table count:",a),e("#boundTableCount").text("-")}e("#userInfo").show(),e("#boundTableCount").css("cursor","pointer").css("text-decoration","underline")}function vt(){e("#userInfo").hide();const o=`
    <div id="notLoggedIn" style="padding: 20px; background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%); border-radius: 12px; margin-bottom: 20px; text-align: center;">
      <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px;">
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24" style="color: #ff4d4f;">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
        </svg>
        <span style="font-size: 16px; font-weight: 600; color: #ff4d4f;" data-i18n="auth.notLoggedIn">${s.t("auth.notLoggedIn")}</span>
      </div>
      <button id="loginBtn" style="
        padding: 10px 24px;
        font-size: 14px;
        font-weight: 600;
        background: linear-gradient(135deg, #ff2442 0%, #ff6b6b 100%);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 2px 8px rgba(255, 36, 66, 0.2);
      " data-i18n="auth.login">${s.t("auth.login")}</button>
    </div>
  `;e("#userInfo").before(o),e("#loginBtn").on("click",async function(){const a=e(this);a.prop("disabled",!0),a.text(s.t("auth.loading"));try{await Ft()}catch(r){console.error("Login error:",r),u(s.t("messages.unknownError"),"error"),a.prop("disabled",!1),a.text(s.t("auth.login"))}})}async function Bt(){try{const o=j();if(!o){u(s.t("messages.pleaseLoginFirst"),"error");return}const a=await fetch("https://shop.leshangyundian.com/feishu/api/table/list",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!a.ok){u(s.t("messages.loadTableListFailed"),"error");return}const r=await a.json(),p=r.data||r;if(!Array.isArray(p)||p.length===0)e("#boundTablesList").html(`<div style="text-align: center; padding: 40px; color: #999;">${s.t("boundTablesList.empty")}</div>`);else{const l=await D.base.getSelection(),g=(l==null?void 0:l.baseId)||"";let x='<div style="display: flex; flex-direction: column; gap: 12px;">';p.forEach(F=>{const $=F.tableName||"-",A=F.tableId||"-",P=F.remark||"-",q=F.appToken||g,G=F.xhsId||"",ae=F.xhsUrl||"",J=!!(G||ae),se=J?`<span style="color: #52c41a; font-weight: 500;">${s.t("boundTablesList.bound")}</span>`:`<span style="color: #999;">${s.t("boundTablesList.notBound")}</span>`,ie=J?`<div style="font-size: 12px; color: #999; margin-top: 4px;">XHS ID: <span style="font-family: monospace; color: #666;">${G||"-"}</span></div>`:"",re=`https://feishu.cn/base/${q}?table=${A}`;x+=`
          <div style="border: 1px solid #e8e8e8; border-radius: 8px; padding: 16px; background: #fafafa;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <div style="flex: 1; min-width: 0;">
                <div style="font-size: 12px; color: #999; margin-bottom: 4px;">${s.t("boundTablesList.tableName")}</div>
                <div style="font-size: 14px; font-weight: 600; color: #333; word-break: break-all;">${$}</div>
              </div>
              <a href="${re}" target="_blank" class="button button-primary button-small" style="text-decoration: none; padding: 6px 12px; font-size: 12px; white-space: nowrap;">
                ${s.t("boundTablesList.openTable")}
              </a>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
              <div>
                <div style="font-size: 12px; color: #999; margin-bottom: 4px;">${s.t("boundTablesList.tableId")}</div>
                <div style="font-size: 13px; color: #666; font-family: monospace; word-break: break-all;">${A}</div>
              </div>
              <div>
                <div style="font-size: 12px; color: #999; margin-bottom: 4px;">${s.t("boundTablesList.xhsBinding")}</div>
                <div style="font-size: 13px;">${se}</div>
                ${ie}
              </div>
            </div>
            ${P&&P!=="-"?`
            <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e8e8e8;">
              <div style="font-size: 12px; color: #999; margin-bottom: 4px;">${s.t("boundTablesList.remark")}</div>
              <div style="font-size: 13px; color: #666; word-break: break-all;">${P}</div>
            </div>
            `:""}
          </div>
        `}),x+="</div>",e("#boundTablesList").html(x)}e("#boundTablesModal").addClass("active")}catch(o){console.error("Failed to load bound tables list:",o),u(s.t("messages.loadTableListFailed"),"error")}}function kt(){e("#boundTablesModal").removeClass("active")}function Tt(o=32){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let p=0;p<o;p++)r+=a.charAt(Math.floor(Math.random()*a.length));return r}async function Ft(){const o=Tt(32),a=await St(o);if(!a.success||!a.authorizeUrl){u(s.t("messages.authFailed"),"error");return}const r=`
    <div id="feishuAuthModal" class="modal-overlay active" style="z-index: 10001;">
      <div class="modal" style="max-width: 500px;">
        <div style="text-align: center; padding: 20px;">
          <div style="font-size: 48px; margin-bottom: 20px;">\u{1F510}</div>
          <h2 style="color: #ff2442; margin-bottom: 16px;" data-i18n="auth.modalTitle">${s.t("auth.modalTitle")}</h2>
          <p style="color: #666; margin-bottom: 24px; line-height: 1.6;" data-i18n="auth.modalMessage">${s.t("auth.modalMessage")}</p>

          <div style="background: #f5f5f5; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
            <div style="font-size: 13px; color: #666; margin-bottom: 8px;" data-i18n="auth.step1">${s.t("auth.step1")}</div>
            <div style="font-size: 13px; color: #666;" data-i18n="auth.step2">${s.t("auth.step2")}</div>
          </div>

          <div id="authStatus" style="margin-bottom: 20px;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 8px; color: #999;">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
              </svg>
              <span data-i18n="auth.waitingAuth">${s.t("auth.waitingAuth")}</span>
            </div>
          </div>

          <div style="display: flex; gap: 12px; justify-content: center;">
            <button id="openAuthPageBtn" style="
              padding: 12px 30px;
              font-size: 15px;
              font-weight: 600;
              background: linear-gradient(135deg, #ff2442 0%, #ff6b6b 100%);
              color: white;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              transition: all 0.3s;
              box-shadow: 0 4px 15px rgba(255, 36, 66, 0.3);
            " data-i18n="auth.openAuthPage">${s.t("auth.openAuthPage")}</button>
            <button id="cancelAuthBtn" style="
              padding: 10px 30px;
              font-size: 14px;
              background: #fff;
              color: #666;
              border: 1px solid #d9d9d9;
              border-radius: 8px;
              cursor: pointer;
              transition: all 0.3s;
            " data-i18n="auth.cancel">${s.t("auth.cancel")}</button>
          </div>
        </div>
      </div>
    </div>
  `;e("body").append(r);let p=!1;e("#openAuthPageBtn").on("click",function(){const g=e(this);g.prop("disabled",!0),g.text(s.t("auth.opened")),window.open(a.authorizeUrl,"_blank"),p||(p=!0,l(o))}),e("#cancelAuthBtn").on("click",function(){e("#feishuAuthModal").remove(),location.reload()});async function l(g){for(let $=0;$<60;$++){try{const A=await fetch("https://shop.leshangyundian.com/feishu/user/feishu-plugin-login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sid:g})});if(A.ok){const P=await A.json();if(P.success===!0&&P.data&&P.data.token){ye(P.data.token),K(P.data),e("#feishuAuthModal").remove(),u(s.t("messages.authSuccess"),"success"),setTimeout(()=>{location.reload()},1e3);return}}}catch(A){console.error("Poll login status error:",A)}await new Promise(A=>setTimeout(A,3e3))}e("#feishuAuthModal").remove(),u(s.t("messages.authTimeout"),"error")}}async function It(){try{const o=j();if(!o)return{loggedIn:!1};const a=await fetch("https://shop.leshangyundian.com/feishu/user/info",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(a.ok){const r=await a.json();if(r.success===!0&&r.data)return K(r.data),await W(r.data),{loggedIn:!0,token:o,data:r.data}}return localStorage.removeItem("xhsnote_token"),{loggedIn:!1}}catch(o){return console.error("Check login status error:",o),{loggedIn:!1}}}async function St(o){try{const a=await fetch(`https://shop.leshangyundian.com/feishu/auth/authorize-url?source=feishu&sid=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(a.ok){const r=await a.json();if(r.success===!0&&r.data)return{success:!0,authorizeUrl:r.data.authorizeUrl,state:r.data.state}}return{success:!1}}catch(a){return console.error("Get authorize URL error:",a),{success:!1}}}async function Et(){var o;try{const a=await It();if(a.loggedIn)return{success:!0,data:a.data};const r=await D.bridge.getEnv(),p=r.tenantKey||"",l=((o=r.user)==null?void 0:o.id)||"",g=new URLSearchParams;g.append("tenantKey",p),g.append("userId",l);const x=await fetch("https://shop.leshangyundian.com/feishu/user/login",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:g});if(x.ok){const F=await x.json();if(F.success===!0&&F.data&&F.data.token)return ye(F.data.token),K(F.data),await W(F.data),{success:!0,data:F.data}}return{success:!1,needAuth:!0}}catch(a){return console.error("Authorization error:",a),{success:!1}}}async function pe(o){try{let a=o.trim();const r=a.match(/^([a-zA-Z0-9]{24})$/);if(r&&r[1])return r[1];if(a.includes("xhslink.com"))try{const l=await fetch(a,{method:"GET",redirect:"manual"});l.headers.has("location")&&(a=l.headers.get("location")||a)}catch(l){console.warn("Failed to resolve xhslink.com redirect:",l)}const p=a.match(/user\/profile\/([a-zA-Z0-9]{24})/);if(p&&p[1])return p[1];throw new Error("Invalid XHS URL format")}catch(a){throw console.error("Error extracting XHS ID:",a),a}}function Ct(o,a){const r=e("#existingTableSelect"),p=e("#singleTableSelect"),l=e("#selectedTableInfo");if(r.find("option:not(:first)").remove(),p.find("option:not(:first)").remove(),l.hide(),!o||o.length===0){r.prop("disabled",!0),p.prop("disabled",!0);return}r.prop("disabled",!1),p.prop("disabled",!1),o.forEach(g=>{const F=!!a.get(g.id),$=F?"\u3010"+s.t("existingTable.bound")+"\u3011":"\u3010"+s.t("existingTable.notBound")+"\u3011",A=e(`
      <option value="${g.id}" data-bound="${F}">
        ${$} ${g.name}
      </option>
    `);r.append(A)}),o.forEach(g=>{const x=e(`
      <option value="${g.id}">
        ${g.name}
      </option>
    `);p.append(x)}),window.tablesData=o,window.boundTablesData=a}async function fe(){const o=e("#existingTableSelect").val();!o||window.tablesData.find(p=>p.id===o)}const te=[{key:"noteId",label:"\u7B14\u8BB0ID",type:1},{key:"authorNickname",label:"\u535A\u4E3B\u6635\u79F0",type:1},{key:"authorRedId",label:"\u535A\u4E3B\u5C0F\u7EA2\u4E66\u53F7",type:1},{key:"bloggerHomepage",label:"\u535A\u4E3B\u4E3B\u9875",type:15},{key:"sticky",label:"\u7F6E\u9876\u6807\u8BC6",type:3},{key:"type",label:"\u7B14\u8BB0\u7C7B\u578B",type:3},{key:"title",label:"\u7B14\u8BB0\u6807\u9898",type:1},{key:"description",label:"\u7B14\u8BB0\u5185\u5BB9",type:1},{key:"imageAttachments",label:"\u5C01\u9762\u56FE/\u56FE\u7247\u5217\u8868",type:17},{key:"tags",label:"\u8BDD\u9898",type:4},{key:"likes",label:"\u70B9\u8D5E\u6570",type:2},{key:"collects",label:"\u6536\u85CF\u6570",type:2},{key:"shares",label:"\u8F6C\u53D1\u6570",type:2},{key:"comments",label:"\u8BC4\u8BBA\u6570",type:2},{key:"videoUrl",label:"\u89C6\u9891\u5730\u5740",type:15},{key:"videoDuration",label:"\u89C6\u9891\u65F6\u957F(\u79D2)",type:2},{key:"videoSubtitle",label:"\u89C6\u9891\u5B57\u5E55",type:1},{key:"videoText",label:"\u89C6\u9891\u6587\u672C",type:1},{key:"publishTime",label:"\u53D1\u5E03\u65F6\u95F4",type:1},{key:"fetchTime",label:"\u83B7\u53D6\u65F6\u95F4",type:1},{key:"source",label:"\u6570\u636E\u6765\u6E90",type:1}];function me(o){const a=e("#fieldSelectionContainer");a.empty();const r=new Set;o&&o.split(",").forEach(l=>{l&&r.add(l.trim())});const p=r.size===0;te.forEach(l=>{const g=p||r.has(l.key),x=e(`
      <div class="field-checkbox-item">
        <input type="checkbox" id="field_${l.key}" value="${l.key}" ${g?"checked":""}>
        <label for="field_${l.key}">${l.label}</label>
      </div>
    `);a.append(x)})}function Dt(){const o=[];return e('#fieldSelectionContainer input[type="checkbox"]:checked').each(function(){const a=e(this).val();a&&o.push(String(a))}),o.join(",")}function de(){const o=[];return e('.fields-showcase-grid input[type="checkbox"]:checked').each(function(){const a=e(this).val();a&&e(this).closest(".field-item").is(":visible")&&o.push(String(a))}),o.join(",")}function At(){const o=localStorage.getItem("defaultFieldSelection");if(o){const a=o.split(",");e('.fields-showcase-grid input[type="checkbox"]').each(function(){const r=e(this).val();e(this).prop("checked",a.includes(r))})}}window.openBindModal=async function(o,a){try{const r=await D.base.getSelection();if(!r||!r.baseId){u(s.t("messages.cannotGetBaseInfo"),"error");return}const l=(await oe()).get(o);e("#bindAppToken").val(r.baseId),e("#bindTableId").val(o),e("#bindTableName").val(a),e("#tableNameDisplay").val(a),e("#displayAppToken").text(r.baseId),e("#displayTableId").text(o),l&&l.id?(e("#modalTitle").text(s.t("modal.editTitle")),e("#bindTableId").data("bindingId",l.id),e("#personalBaseToken").val(l.personalBaseToken||""),e("#remark").val(l.remark||""),l.xhsUrl?e("#xhsUrl").val(l.xhsUrl):l.xhsId?e("#xhsUrl").val(l.xhsId):e("#xhsUrl").val(""),l.xhsId?e("#displayXhsId").text(l.xhsId):e("#displayXhsId").text("-"),me(l.fields)):(e("#modalTitle").text(s.t("modal.bindTitle")),e("#bindTableId").data("bindingId",null),e("#personalBaseToken").val(""),e("#xhsUrl").val(""),e("#remark").val(""),e("#displayXhsId").text("-"),me()),e("#bindModal").addClass("active")}catch(r){console.error("Error opening bind modal:",r),u(s.t("messages.openModalFailed"),"error")}};window.closeBindModal=function(){e("#bindModal").removeClass("active")};window.closeBoundTablesModal=kt;let ne=null,U=null,H=null,z=null;function $t(){const o=Math.floor(Math.random()*6)+1,a=Math.floor(Math.random()*60),r=Math.floor(Math.random()*60),p=new Date().getTime()+o*60*60*1e3+a*60*1e3+r*1e3,l=()=>{const g=new Date().getTime(),x=p-g;if(x<0){e("#promoCountdown").text("00:00:00"),H&&(clearInterval(H),H=null);return}const F=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),$=Math.floor(x%(1e3*60*60)/(1e3*60)),A=Math.floor(x%(1e3*60)/1e3);e("#promoCountdown").text(`${String(F).padStart(2,"0")}:${String($).padStart(2,"0")}:${String(A).padStart(2,"0")}`)};l(),H=window.setInterval(l,1e3)}async function we(){try{const o=j();if(!o){u(s.t("messages.pleaseLoginFirst"),"error");return}ne=null,U&&(clearInterval(U),U=null),H&&(clearInterval(H),H=null),e("#paymentMethodSection").hide(),e("#paymentQrSection").hide(),e("#productsList").html(`<div style="text-align: center; padding: 40px; color: #999;">${s.t("recharge.loading")}</div>`),e("#rechargeModal").addClass("active"),$t();const a=await fetch("https://shop.leshangyundian.com/feishu/user/recharge-products?type=NOTE",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const r=await a.json();if(!r.success&&r.code!==200||!r.data||!Array.isArray(r.data))throw new Error("Invalid response format");const p=r.data;if(p.length===0){e("#productsList").html(`<div style="text-align: center; padding: 40px; color: #999;">${s.t("recharge.loadFailed")}</div>`);return}let l="";p.forEach(g=>{const x=g.discount&&g.discount>0;let F="",$="";const A=g.title.match(/(\d+)\s*积分/),P=A?A[1]:"";g.type==="VIP"?(F=s.t("recharge.vip"),$="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"):(g.type==="NOTE"||g.type==="POINTS")&&(F="",$=""),l+=`
        <div class="product-card" data-product-id="${g.id}" style="
          border: 2px solid #e8e8e8;
          border-radius: 12px;
          padding: 16px;
          cursor: pointer;
          transition: all 0.3s;
          background: white;
          position: relative;
          text-align: center;
        ">
          ${x?`<div style="position: absolute; top: 8px; right: 8px; background: linear-gradient(135deg, #ff6b6b 0%, #ff4d4f 100%); color: white; padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; box-shadow: 0 2px 4px rgba(255, 77, 79, 0.3);">-${g.discount}%</div>`:""}

          <div style="margin-bottom: 12px;">
            ${P?`
            <div style="font-size: 32px; font-weight: 800; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 4px;">
              ${P}
            </div>
            <div style="font-size: 13px; color: #999; font-weight: 500;">\u79EF\u5206</div>
            `:`
            <div style="font-size: 14px; font-weight: 600; color: #333; line-height: 1.4;">${g.title}</div>
            `}
          </div>

          <div style="display: flex; align-items: baseline; justify-content: center; gap: 6px; padding-top: 8px; border-top: 1px solid #f0f0f0;">
            <span style="font-size: 24px; font-weight: 700; color: #ff4d4f;">\xA5${g.price.toFixed(2)}</span>
            ${x?`<span style="font-size: 13px; color: #999; text-decoration: line-through;">\xA5${g.originalPrice.toFixed(2)}</span>`:""}
          </div>
        </div>
      `}),e("#productsList").html(l),e(".product-card").on("click",function(){e(".product-card").css("border-color","#e8e8e8").css("background","white"),e(this).css("border-color","#ff4d4f").css("background","#fff5f5"),ne=parseInt(e(this).data("product-id")),e("#paymentMethodSection").slideDown()})}catch(o){console.error("Failed to load recharge products:",o),u(s.t("recharge.loadFailed")+": "+(o instanceof Error?o.message:String(o)),"error"),e("#productsList").html(`<div style="text-align: center; padding: 40px; color: #999;">${s.t("recharge.loadFailed")}</div>`)}}function ve(){U&&(clearInterval(U),U=null),H&&(clearInterval(H),H=null),z&&(clearInterval(z),z=null),e("#rechargeModal").removeClass("active")}async function Lt(){if(!ne){u(s.t("recharge.selectPackage"),"warning");return}const o=j(),a=xe();if(!o||!a){u(s.t("messages.pleaseLoginFirst"),"error");return}const r=e('input[name="paymentType"]:checked').val();try{const p=u(s.t("recharge.creatingOrder"),"loading"),l=await fetch(`https://shop.leshangyundian.com/feishu/user/createorder?token=${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({productId:String(ne),userId:a.userId,paymentType:r})});if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);const g=await l.json();if(!g.success||!g.data)throw new Error(g.msg||s.t("recharge.orderFailed"));u(s.t("recharge.orderCreated"),"success",p);const x=g.data,F=x.tradeOrderId,$=x.totalAmount,A=await fetch(`https://shop.leshangyundian.com/feishu/user/pay?token=${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({orderId:F,paymentType:r})});if(!A.ok)throw new Error(`HTTP ${A.status}: ${A.statusText}`);const P=await A.json();if(!P.success||!P.data)throw new Error(P.msg||s.t("recharge.paymentFailed"));const q=P.data;e("#paymentQrCode").attr("src",q.qrCodeImage),e("#displayOrderId").text(F),$!=null&&e("#paymentAmount").text(`\xA5${Number($).toFixed(2)}`);const G=r==="alipay"?s.t("recharge.scanWithAlipay"):s.t("recharge.scanWithWechat");e("#paymentMethodHint").text(G),e("#paymentMethodSection").hide(),e("#paymentQrSection").fadeIn(),Ut(300),Mt(F,o)}catch(p){console.error("Failed to create order or get payment:",p),u(p instanceof Error?p.message:String(p),"error")}}async function Pt(o,a){try{const r=await fetch(`https://shop.leshangyundian.com/feishu/user/order-status/${o}?token=${a}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(!r.ok)return console.error("Order status check failed:",r.status),{status:0};const p=await r.json();return p.success&&p.data?{status:p.data.status,data:p.data}:{status:0}}catch(r){return console.error("Order status check error:",r),{status:0}}}function Mt(o,a){z&&clearInterval(z),be(o,a),z=window.setInterval(()=>{be(o,a)},3e3)}async function be(o,a){var p,l;const r=await Pt(o,a);if(r.status===1){z&&(clearInterval(z),z=null),U&&(clearInterval(U),U=null),e("#paymentQrSection").html(`
      <div style="text-align: center; padding: 40px;">
        <svg width="80" height="80" fill="none" stroke="#52c41a" viewBox="0 0 24 24" style="margin-bottom: 20px;">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <h3 style="font-size: 24px; font-weight: 600; color: #52c41a; margin-bottom: 12px;">\u652F\u4ED8\u6210\u529F\uFF01</h3>
        <p style="font-size: 16px; color: #666; margin-bottom: 8px;">${((p=r.data)==null?void 0:p.itemName)||"\u5145\u503C\u6210\u529F"}</p>
        <p style="font-size: 14px; color: #999;">\u83B7\u5F97\u989D\u5EA6: ${((l=r.data)==null?void 0:l.itemValue)||"-"}</p>
        <button onclick="closeRechargeModal()" style="
          margin-top: 24px;
          padding: 12px 32px;
          font-size: 16px;
          font-weight: 600;
          background: linear-gradient(135deg, #52c41a 0%, #389e0d 100%);
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.3s;
        ">\u5173\u95ED</button>
      </div>
    `);const g=await fetch("https://shop.leshangyundian.com/feishu/user/info",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(g.ok){const x=await g.json();x.success===!0&&x.data&&(K(x.data),await W(x.data))}u("\u5145\u503C\u6210\u529F\uFF01","success")}else r.status===-1&&(z&&(clearInterval(z),z=null),U&&(clearInterval(U),U=null),u("\u8BA2\u5355\u5DF2\u53D6\u6D88","warning"),ve())}function Ut(o){let a=o;const r=()=>{if(a<=0){U&&(clearInterval(U),U=null),z&&(clearInterval(z),z=null),e("#paymentQrSection").html(`
        <div style="text-align: center; padding: 40px;">
          <svg width="80" height="80" fill="none" stroke="#ff4d4f" viewBox="0 0 24 24" style="margin-bottom: 20px;">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <h3 style="font-size: 24px; font-weight: 600; color: #ff4d4f; margin-bottom: 12px;">\u652F\u4ED8\u8D85\u65F6</h3>
          <p style="font-size: 16px; color: #666;">\u4E8C\u7EF4\u7801\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u4E0B\u5355</p>
          <button onclick="closeRechargeModal()" style="
            margin-top: 24px;
            padding: 12px 32px;
            font-size: 16px;
            font-weight: 600;
            background: linear-gradient(135deg, #ff4d4f 0%, #ff7875 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
          ">\u5173\u95ED</button>
        </div>
      `),u("\u652F\u4ED8\u8D85\u65F6\uFF0C\u4E8C\u7EF4\u7801\u5DF2\u8FC7\u671F","warning");return}const p=Math.floor(a/60),l=a%60,g=`${s.t("recharge.expiresIn").replace("{minutes}",String(p).padStart(2,"0")).replace("{seconds}",String(l).padStart(2,"0"))}`;e("#countdownTimer").text(g),a--};r(),U=window.setInterval(r,1e3)}window.openRechargeModal=we;window.closeRechargeModal=ve;async function zt(){const o=e("#xhsUrl").val();if(!o){e("#displayXhsId").text("-");return}try{const a=await pe(o);e("#displayXhsId").text(a)}catch{e("#displayXhsId").text(s.t("messages.invalidUrl")),u(s.t("messages.invalidUrl"),"warning")}}async function oe(){const o=new Map;try{const a=j();if(!a)return console.warn("[loadBoundTables] No token available"),o;const r=await D.base.getSelection();if(!r||!r.baseId)return console.warn("[loadBoundTables] No baseId available"),o;const p=await fetch(`https://shop.leshangyundian.com/feishu/api/table/list?appToken=${r.baseId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}});if(p.ok){const l=await p.json(),g=l.data||l;Array.isArray(g)&&g.forEach(x=>{x.fields&&Array.isArray(x.fields)&&(x.fields=x.fields.join(",")),o.set(x.tableId,x)})}else console.error("[loadBoundTables] HTTP Error:",p.status,p.statusText)}catch(a){console.error("[loadBoundTables] Error:",a)}return o}async function Nt(o){try{const a=j();if(!a)return u(s.t("messages.pleaseLoginFirst"),"error"),!1;const r=u(s.t("messages.saving"),"loading"),p=await fetch("https://shop.leshangyundian.com/feishu/api/table/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(o)});if(p.ok){const l=await p.json();if(l.success===!0)return u(s.t("messages.saveSuccess"),"success",r),!0;{const g=l.msg||l.message||s.t("messages.saveFailed");return u(g,"error",r),!1}}else return u(`${s.t("messages.saveFailed")}: ${p.statusText}`,"error",r),!1}catch(a){return u(`${s.t("messages.saveFailed")}: ${a}`,"error"),!1}}window.unbindTable=async function(o){const r=(await oe()).get(o);if(!r||!r.id){u("\u672A\u627E\u5230\u7ED1\u5B9A\u8BB0\u5F55","error");return}if(!!confirm(s.t("messages.confirmUnbind")))try{const p=j();if(!p){u(s.t("messages.pleaseLoginFirst"),"error");return}const l=u(s.t("messages.unbinding"),"loading"),g=await fetch(`https://shop.leshangyundian.com/feishu/api/table/delete/${r.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}});if(g.ok){const x=await g.json();if(x.success===!0)u(s.t("messages.unbindSuccess"),"success",l),await Q();else{const F=x.msg||x.message||s.t("messages.unbindFailed");u(F,"error",l)}}else u(`${s.t("messages.unbindFailed")}: ${g.statusText}`,"error",l)}catch(p){console.error("Error unbinding table:",p),u(`${s.t("messages.unbindFailed")}: ${p}`,"error")}};async function Q(){try{const o=await D.base.getTableMetaList(),a=await oe();Ct(o,a)}catch(o){console.error("Error refreshing table list:",o),u(s.t("messages.loadTableListFailed"),"error")}}e(document).ready(async function(){window.addEventListener("error",function(t){console.error("Uncaught error:",t.error)}),window.addEventListener("unhandledrejection",function(t){console.error("Unhandled promise rejection:",t.reason)});try{if(typeof D>"u")console.error("Bitable API not available"),setTimeout(()=>{window.location.href="https://feishu.cn"},1e3);else try{const t=await D.bridge.getEnv();(!t.product||t.product!=="feishu"&&t.product!=="lark")&&(console.error("Not in Feishu or Lark environment"),setTimeout(()=>{window.location.href="https://feishu.cn"},1e3))}catch(t){console.warn("Environment check failed, but continuing:",t)}}catch(t){console.error("Environment check encountered error:",t)}const o=xe();o&&await W(o),At(),wt();const a=await Et();if(!a.success){if(a.needAuth)vt();else{let t="",n="";try{const i=await D.bridge.getTenantKey(),h=await D.bridge.getBaseUserId();t=i||"\u65E0\u6CD5\u83B7\u53D6",n=h||"\u65E0\u6CD5\u83B7\u53D6"}catch(i){console.error("Failed to get debug info:",i)}e("body").html(`
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #ffeef2 0%, #ffe4e8 100%);">
          <div style="text-align: center; padding: 40px; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(255, 107, 107, 0.2); max-width: 700px;">
            <div style="font-size: 64px; margin-bottom: 20px;">\u{1F614}</div>
            <h1 style="color: #ff2442; margin-bottom: 16px;" data-i18n="auth.failed">${s.t("auth.failed")}</h1>
            <p style="color: #666; margin-bottom: 24px;" data-i18n="auth.failedMessage">${s.t("auth.failedMessage")}</p>

            <div style="background: #f5f5f5; padding: 20px; border-radius: 12px; margin-bottom: 24px; text-align: left;">
              <p style="margin: 0 0 10px 0;"><strong>Tenant Key:</strong></p>
              <code style="display: block; background: white; padding: 10px; border-radius: 6px; word-break: break-all; color: #ff2442;">${t}</code>

              <p style="margin: 20px 0 10px 0;"><strong>Base User ID:</strong></p>
              <code style="display: block; background: white; padding: 10px; border-radius: 6px; word-break: break-all; color: #ff2442;">${n}</code>
            </div>

            <button onclick="location.reload()" style="padding: 12px 32px; background: linear-gradient(135deg, #ff2442 0%, #ff6b6b 100%); color: white; border: none; border-radius: 12px; font-size: 16px; cursor: pointer; transition: transform 0.2s; margin-right: 12px;">
              \u91CD\u65B0\u52A0\u8F7D
            </button>
          </div>
        </div>
      `)}ge();return}ge(),await Q(),e("#xhsUrl").on("input",async function(){await zt()}),e("#bindForm").on("submit",async function(t){t.preventDefault();try{const n=e("#bindAppToken").val(),i=e("#bindTableId").val(),h=e("#bindTableName").val(),d=e("#personalBaseToken").val(),c=e("#xhsUrl").val(),m=e("#remark").val(),w=Dt(),v=e("#bindTableId").data("bindingId");if(!d.trim()){u(s.t("messages.pleaseInputPersonalBaseToken"),"error");return}let b="";if(c.trim())try{b=await pe(c)}catch{u(s.t("messages.extractXhsIdFailed"),"error");return}let E="";try{const f=await D.base.getSelection();if(f&&f.baseId){E=`https://feishu.cn/base/${f.baseId}`;try{(await D.bridge.getEnv()).product==="lark"&&(E=`https://larksuite.com/base/${f.baseId}`)}catch(y){console.warn("Failed to check environment:",y)}}}catch(f){console.warn("Failed to get base URL:",f)}const B={appToken:n,tableId:i,tableName:h,personalBaseToken:d,xhsUrl:c.trim(),xhsId:b,remark:m||"",fields:w,baseUrl:E};v&&(B.id=v),await Nt(B)&&(window.closeBindModal(),await Q())}catch(n){console.error("Error submitting bind form:",n),u(s.t("messages.extractXhsIdFailed"),"error")}}),e("#refreshUserInfo").on("click",async function(){const t=j();if(!t){u(s.t("messages.pleaseLoginFirst"),"error");return}const n=e(this),i=n.find("svg");n.prop("disabled",!0),i.css("animation","spin 1s linear infinite");try{const h=u(s.t("messages.refreshingUserInfo"),"loading"),d=await fetch("https://shop.leshangyundian.com/feishu/user/info",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(d.ok){const c=await d.json();c.success===!0&&c.data?(K(c.data),await W(c.data),u(s.t("messages.userInfoRefreshSuccess"),"success",h)):(u(s.t("messages.refreshFailed")+": "+(c.message||s.t("messages.unknownError")),"error",h),d.status===401&&(localStorage.removeItem("xhsnote_token"),localStorage.removeItem("xhsnote_user_info"),u(s.t("messages.authorizationExpired"),"error")))}else throw new Error(`HTTP ${d.status}: ${d.statusText}`)}catch(h){console.error("Refresh user info error:",h),u(s.t("messages.refreshFailed")+": "+(h instanceof Error?h.message:String(h)),"error")}finally{n.prop("disabled",!1),i.css("animation","")}}),e("#boundTableCount").on("click",function(){Bt()}),e("#rechargeDownloadsBtn").on("click",function(){we()}),e("#selectAllFieldsBtn").on("click",function(){e('.fields-showcase-grid input[type="checkbox"]').prop("checked",!0)}),e("#deselectAllFieldsBtn").on("click",function(){e('.fields-showcase-grid input[type="checkbox"]').prop("checked",!1)}),e(".fields-showcase-grid").on("click",".field-item",function(t){if(t.target.classList.contains("field-checkbox"))return;const n=e(this).find(".field-checkbox");n.prop("checked",!n.prop("checked"))}),e("#submitOrderBtn").on("click",function(){Lt()}),e("#saveFieldSelectionBtn").on("click",async function(){const t=de(),n=e("#existingTableSelect").val();if(n){const h=(await oe()).get(n);if(h&&h.id){const d=u("\u6B63\u5728\u66F4\u65B0\u5B57\u6BB5\u914D\u7F6E...","loading");try{const c=j();if(!c){u("\u8BF7\u5148\u767B\u5F55","error",d);return}let m="";try{const b=await D.base.getSelection();if(b&&b.baseId){m=`https://feishu.cn/base/${b.baseId}`;try{(await D.bridge.getEnv()).product==="lark"&&(m=`https://larksuite.com/base/${b.baseId}`)}catch(E){console.warn("Failed to check environment:",E)}}}catch(b){console.warn("Failed to get base URL:",b)}const w={...h,fields:t,baseUrl:m},v=await fetch("https://shop.leshangyundian.com/feishu/api/table/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(w)});if(v.ok){const b=await v.json();b.success===!0?(u("\u5B57\u6BB5\u914D\u7F6E\u5DF2\u66F4\u65B0\u5230\u8868\u683C","success",d),await Q(),e("#existingTableSelect").val(n),await fe()):u("\u66F4\u65B0\u5931\u8D25: "+(b.msg||b.message||"\u672A\u77E5\u9519\u8BEF"),"error",d)}else u(`\u66F4\u65B0\u5931\u8D25: ${v.statusText}`,"error",d)}catch(c){console.error("\u66F4\u65B0\u5B57\u6BB5\u914D\u7F6E\u5931\u8D25:",c),u("\u66F4\u65B0\u5931\u8D25: "+(c instanceof Error?c.message:String(c)),"error",d)}return}}localStorage.setItem("defaultFieldSelection",t),u(s.t("messages.fieldSelectionSaved"),"success")});let r=!1,p=!1,l="blogger";e("#tabBlogger").on("click",function(){l="blogger",e("#tabBlogger").addClass("tab-active"),e("#tabSingle").removeClass("tab-active"),e("#tabAutoPush").removeClass("tab-active"),e("#bloggerTabContent").show(),e("#singleTabContent").hide(),e("#autoPushTabContent").hide(),e("#startProcessingBtn").text("\u5F00\u59CB\u6839\u636E\u535A\u4E3B\u4E3B\u9875\u83B7\u53D6"),e("#buttonHint").text("\u5C06\u81EA\u52A8\u83B7\u53D6\u535A\u4E3B\u7684\u6240\u6709\u7B14\u8BB0\u5E76\u6DFB\u52A0\u5230\u8868\u683C"),e("#fieldsHint").html("\u{1F4A1} \u6839\u636E\u535A\u4E3B\u4E3B\u9875\u83B7\u53D6\uFF1A\u7B14\u8BB0\u5185\u5BB9\u548C\u8BDD\u9898\u4E3A\u90E8\u5206\u6570\u636E"),e("#bloggerHomepageField").show(),e(".fields-showcase-title").text("\u53EF\u83B7\u53D6\u6570\u636E"),e("#selectAllFieldsBtn, #deselectAllFieldsBtn, #saveFieldSelectionBtn").show(),e(".field-checkbox").prop("disabled",!1),e("#startProcessingBtn").show(),e("#buttonHint").show()}),e("#tabSingle").on("click",function(){l="single",e("#tabSingle").addClass("tab-active"),e("#tabBlogger").removeClass("tab-active"),e("#tabAutoPush").removeClass("tab-active"),e("#singleTabContent").show(),e("#bloggerTabContent").hide(),e("#autoPushTabContent").hide(),e("#startProcessingBtn").text("\u5F00\u59CB\u5B8C\u6574\u6570\u636E\u83B7\u53D6"),e("#buttonHint").text("\u5C06\u6839\u636E\u7B14\u8BB0ID\u83B7\u53D6\u8BE6\u7EC6\u4FE1\u606F\u5E76\u66F4\u65B0\u8868\u683C\u6570\u636E"),e("#fieldsHint").html("\u{1F4A1} \u5B8C\u6574\u6570\u636E\u83B7\u53D6\uFF1A\u7B14\u8BB0\u5185\u5BB9\u548C\u8BDD\u9898\u4E3A\u5B8C\u6574\u6570\u636E"),e("#bloggerHomepageField").hide(),e(".fields-showcase-title").text("\u53EF\u83B7\u53D6\u6570\u636E"),e("#selectAllFieldsBtn, #deselectAllFieldsBtn, #saveFieldSelectionBtn").show(),e(".field-checkbox").prop("disabled",!1),e("#startProcessingBtn").show(),e("#buttonHint").show()}),e("#tabAutoPush").on("click",function(){l="autoPush",e("#tabAutoPush").addClass("tab-active"),e("#tabBlogger").removeClass("tab-active"),e("#tabSingle").removeClass("tab-active"),e("#autoPushTabContent").show(),e("#bloggerTabContent").hide(),e("#singleTabContent").hide(),e("#fieldsHint").html("\u{1F4A1} \u81EA\u52A8\u63A8\u9001\uFF1A\u7CFB\u7EDF\u5C06\u81EA\u52A8\u63A8\u9001\u535A\u4E3B\u7684\u65B0\u7B14\u8BB0\u5230\u8868\u683C"),e("#bloggerHomepageField").show(),e(".fields-showcase-title").text("\u53EF\u63A8\u9001\u6570\u636E"),e("#selectAllFieldsBtn, #deselectAllFieldsBtn, #saveFieldSelectionBtn").hide(),e(".field-checkbox").prop("checked",!0).prop("disabled",!0),e("#startProcessingBtn").hide(),e("#buttonHint").hide()}),e("#singleTableSelect").on("change",async function(){const t=e(this).val(),n=e("#noteIdColumnSelect");if(!t){n.empty().append('<option value="">\u8BF7\u5148\u9009\u62E9\u8868\u683C</option>').prop("disabled",!0);return}try{const i=await D.base.getTableById(t),h=await i.getFieldList();n.empty().append('<option value="">\u8BF7\u9009\u62E9\u7B14\u8BB0ID\u5217</option>');for(const d of h){const c=await i.getFieldMetaById(d.id);if(c.type===1){const m=`<option value="${d.id}">${c.name}</option>`;n.append(m)}}n.prop("disabled",!1)}catch(i){console.error("\u52A0\u8F7D\u5B57\u6BB5\u5217\u8868\u5931\u8D25:",i),u("\u52A0\u8F7D\u5B57\u6BB5\u5217\u8868\u5931\u8D25","error")}}),e("#startProcessingBtn").on("click",async function(){try{if(l==="blogger")await g();else if(l==="single")await x();else if(l==="autoPush"){u("\u656C\u8BF7\u671F\u5F85\uFF1A\u81EA\u52A8\u63A8\u9001\u529F\u80FD\u6B63\u5728\u5F00\u53D1\u4E2D","info");return}}catch(t){console.error("Start processing error:",t),u("\u5904\u7406\u5931\u8D25: "+((t==null?void 0:t.message)||"\u672A\u77E5\u9519\u8BEF"),"error"),e("#startProcessingBtn").prop("disabled",!1),e("#startProcessingBtn").css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"}),e("#progressContainer").hide()}});async function g(){const t=e("#existingTableSelect").val();if(!t){u("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8868\u683C","error");return}const n=e("#bloggerUrlInput").val();if(!n||n.trim()===""){u("\u8BF7\u8F93\u5165\u5C0F\u7EA2\u4E66\u535A\u4E3B\u94FE\u63A5\u6216ID","warning");return}const i=e("#fetchModeSelect").val();let h=de();if(!h||h===""){u("\u8BF7\u5148\u9009\u62E9\u8981\u91C7\u96C6\u7684\u5B57\u6BB5","warning");return}const d=j();if(!d){u("\u8BF7\u5148\u91CD\u65B0\u767B\u5F55\u83B7\u53D6\u6388\u6743","error");return}let c="";try{c=await pe(n)}catch{u("\u63D0\u53D6\u535A\u4E3BID\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u94FE\u63A5\u683C\u5F0F","error");return}r=!1,p=!1,e("#progressContainer").show(),e("#pauseStatus").hide(),e("#pauseBtn").text("\u6682\u505C").prop("disabled",!1),e("#startProcessingBtn").prop("disabled",!0),e("#startProcessingBtn").css({opacity:"0.5",cursor:"not-allowed",background:"#d9d9d9","pointer-events":"none"}),await q(t,c,h,d,i)}async function x(){const t=e("#singleTableSelect").val();if(!t){u("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u8868\u683C","error");return}const n=e("#noteIdColumnSelect").val();if(!n){u("\u8BF7\u5148\u9009\u62E9\u7B14\u8BB0ID\u5217","warning");return}let i=de();if(!i||i===""){u("\u8BF7\u5148\u9009\u62E9\u8981\u91C7\u96C6\u7684\u5B57\u6BB5","warning");return}const h=j();if(!h){u("\u8BF7\u5148\u91CD\u65B0\u767B\u5F55\u83B7\u53D6\u6388\u6743","error");return}try{const d=await D.base.getTableById(t),c=u("\u6B63\u5728\u6253\u5F00\u8BB0\u5F55\u9009\u62E9\u5668...","loading"),m=await D.base.getSelection();if(!m.viewId){u("\u65E0\u6CD5\u83B7\u53D6\u89C6\u56FEID\uFF0C\u8BF7\u91CD\u8BD5","error");return}const w=await D.ui.selectRecordIdList(t,m.viewId);if(c&&c.parentNode&&c.parentNode.removeChild(c),!w||w.length===0){u("\u672A\u9009\u62E9\u4EFB\u4F55\u8BB0\u5F55\uFF0C\u64CD\u4F5C\u5DF2\u53D6\u6D88","warning");return}r=!1,p=!1,e("#progressContainer").show(),e("#userCardTitle").hide(),e("#userCard").hide(),e("#pauseStatus").hide(),e("#pauseBtn").text("\u6682\u505C").prop("disabled",!1),e("#startProcessingBtn").prop("disabled",!0),e("#startProcessingBtn").css({opacity:"0.5",cursor:"not-allowed",background:"#d9d9d9","pointer-events":"none"}),await F(d,w,n,i,h)}catch(d){console.error("\u5904\u7406\u5931\u8D25:",d),u("\u5904\u7406\u5931\u8D25: "+(d instanceof Error?d.message:String(d)),"error"),e("#startProcessingBtn").prop("disabled",!1).css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"})}}async function F(t,n,i,h,d){try{const c=n.length;let m=0,w=0,v=0;const b=await G(t,h.split(",")),E=await D.bridge.getBaseUserId();for(const B of n){for(;r&&!p;)await new Promise(T=>setTimeout(T,100));if(p)break;try{const f=(await t.getRecordById(B)).fields[i];let y="";if(typeof f=="string")y=f;else if(f&&typeof f=="object")if(Array.isArray(f)&&f.length>0){const k=f[0];y=k.text||k.value||""}else y=f.text||f.value||"";if(!y||y.trim()===""){v++,m++,$(m,c,`\u6B63\u5728\u5904\u7406: ${m}/${c} (\u6210\u529F: ${w}, \u8DF3\u8FC7: ${v})`);continue}y=y.trim(),$(m,c,`\u6B63\u5728\u83B7\u53D6\u7B14\u8BB0: ${y} (${m+1}/${c})`);const M=localStorage.getItem("xhsCookie")||"",S=await(await fetch("https://shop.leshangyundian.com/feishu/user/xhs/note",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({noteId:y})})).json();if(S.success&&S.data){const k=S.data;await J(t,B,k,b),w++}else console.error("\u83B7\u53D6\u7B14\u8BB0\u5931\u8D25:",y,S.msg),v++}catch(T){console.error("\u5904\u7406\u8BB0\u5F55\u5931\u8D25:",B,T),v++}if(m++,$(m,c,`\u6B63\u5728\u5904\u7406: ${m}/${c} (\u6210\u529F: ${w}, \u5931\u8D25: ${v})`),m<c){const T=Math.floor(Math.random()*200)+300;await new Promise(f=>setTimeout(f,T))}}$(c,c,`\u5904\u7406\u5B8C\u6210! \u603B\u6570: ${c}, \u6210\u529F: ${w}, \u5931\u8D25: ${v}`),u(`\u5904\u7406\u5B8C\u6210! \u6210\u529F: ${w}, \u5931\u8D25: ${v}`,"success");try{const B=await fetch("https://shop.leshangyundian.com/feishu/user/info",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`}});if(B.ok){const T=await B.json();T.success===!0&&T.data&&(K(T.data),await W(T.data))}}catch(B){console.error("\u5237\u65B0\u7528\u6237\u4FE1\u606F\u5931\u8D25:",B)}e("#startProcessingBtn").prop("disabled",!1).css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"}),setTimeout(()=>{e("#progressContainer").fadeOut(300)},3e3)}catch(c){console.error("Process single notes error:",c),u("\u5904\u7406\u5931\u8D25: "+((c==null?void 0:c.message)||"\u672A\u77E5\u9519\u8BEF"),"error"),e("#startProcessingBtn").prop("disabled",!1).css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"}),e("#progressContainer").hide()}}e("#pauseBtn").on("click",function(){r||(r=!0,p=!0,e("#pauseBtn").text("\u5DF2\u6682\u505C").prop("disabled",!0),e("#pauseStatus").show())}),e("#resumeBtn").on("click",async function(){r=!1,p=!1,e("#pauseStatus").hide(),e("#pauseBtn").text("\u6682\u505C").prop("disabled",!1)});function $(t,n,i){const h=n>0?Math.round(t/n*100):0;e("#progressBar").css("width",h+"%"),e("#progressText").text(i),e("#progressStats").text(`\u5DF2\u83B7\u53D6: ${t} \u6761`)}function A(t){if(!t)return;const n=t.basicInfo||{},i=t.detailedInfo||{},h=t.statistics||{},d=n.avatar||"";d?(e("#userAvatarImg").attr("src",d).show(),e("#userAvatarPlaceholder").hide()):(e("#userAvatarImg").hide(),e("#userAvatarPlaceholder").show());const c=n.nickname||"\u672A\u77E5\u7528\u6237";e("#userName").text(c);const m=n.redId||"";m?e("#userRedId").text("\u535A\u4E3B\u5C0F\u7EA2\u4E66\u53F7: "+m).show():e("#userRedId").hide();const w=i.description||n.desc||"\u6682\u65E0\u7B80\u4ECB";e("#userDesc").text(w);const v=parseInt(h.fansCount||n.fansCount||0);e("#userFans").text(P(v));const b=parseInt(h.postedNotes||0);e("#userNotes").text(P(b));const E=parseInt(h.likedCount||0),B=parseInt(h.collectedNotes||h.colle||0),T=parseInt(h.collectedCount||0),f=E+B+T;e("#userLikes").text(P(f)),e("#userCardTitle").fadeIn(300),e("#userCard").fadeIn(300)}function P(t){return t>=1e4?(t/1e4).toFixed(1)+"\u4E07":t.toLocaleString()}async function q(t,n,i,h,d="all"){try{const c=await D.base.getTableById(t),m=await G(c,i.split(","));await new Promise(I=>setTimeout(I,2e3));const w=await c.getFieldMetaList(),v=new Map;w.forEach(I=>{v.set(I.name,I.id)});const b=new Map;for(const I of i.split(",")){const S=te.find(k=>k.key===I);!S||v.has(S.label)&&b.set(I,v.get(S.label))}const E=b.get("noteId");let B="";if(d==="append"&&E)try{const I=await c.getRecords({pageSize:1});if(I&&I.records&&I.records.length>0){const k=I.records[0].fields[E];if(typeof k=="string")B=k;else if(k&&typeof k=="object")if(Array.isArray(k)&&k.length>0){const L=k[0];B=L.text||L.value||""}else{const L=k;B=L.text||L.value||""}}}catch{B=""}let T=0,f=0,y=0,M=!0;for(;M&&!p;){for(y++;r&&!p;)await new Promise(O=>setTimeout(O,500));if(p)break;const I={xhsId:n};B&&(I.cursor=B);const S=await fetch("https://shop.leshangyundian.com/feishu/user/xhs/notes",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},body:JSON.stringify(I)});if(!S.ok)throw new Error(`HTTP ${S.status}: ${S.statusText}`);const k=await S.json();if(!k.success||!k.data)throw new Error(k.msg||"\u83B7\u53D6\u7B14\u8BB0\u5217\u8868\u5931\u8D25");const L=k.data,N=L.notes||[],C=L.userData||{};if(M=L.hasMore===!0,y===1&&C&&Object.keys(C).length>0&&A(C),N.length===0)break;$(T,0,`\u6B63\u5728\u5904\u7406\u7B2C ${y} \u9875...`);for(let O=0;O<N.length&&!p;O++)try{const _=N[O],$e=await c.addRecord({fields:{}});await J(c,$e,_,b,C),T++,$(T,0,`\u6B63\u5728\u5904\u7406\u7B2C ${y} \u9875\uFF0C\u7B2C ${O+1}/${N.length} \u6761\u7B14\u8BB0...`),O<N.length-1&&await new Promise(Le=>setTimeout(Le,500))}catch(_){f++,console.error("\u6DFB\u52A0\u7B14\u8BB0\u5931\u8D25:",_)}if(p)break;M&&(B=N[N.length-1].id,await new Promise(_=>setTimeout(_,1e3)))}e("#progressBar").css("width","100%"),e("#progressText").text("\u5B8C\u6210\uFF01"),e("#pauseBtn").prop("disabled",!0),u(`\u5904\u7406\u5B8C\u6210\uFF01\u6210\u529F\u6DFB\u52A0: ${T}, \u5931\u8D25: ${f}`,"success"),e("#startProcessingBtn").prop("disabled",!1),e("#startProcessingBtn").css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"}),setTimeout(()=>{e("#progressContainer").hide(),e("#pauseBtn").text("\u6682\u505C").prop("disabled",!1),e("#progressBar").css("width","0%")},3e3)}catch(c){console.error("\u83B7\u53D6\u535A\u4E3B\u7B14\u8BB0\u5931\u8D25:",c),u("\u83B7\u53D6\u7B14\u8BB0\u5931\u8D25: "+((c==null?void 0:c.message)||"\u672A\u77E5\u9519\u8BEF"),"error"),e("#startProcessingBtn").prop("disabled",!1),e("#startProcessingBtn").css({opacity:"1",cursor:"pointer",background:"","pointer-events":"auto"}),e("#progressContainer").hide()}}async function G(t,n){const i=new Map,h=await t.getFieldMetaList(),d=new Map;h.forEach(c=>{d.set(c.name,c.id)});for(const c of n){const m=te.find(v=>v.key===c);if(!m)continue;let w;if(d.has(m.label))w=d.get(m.label);else try{w=(await ae(t,m.label,m.type)).id}catch(v){console.error(`\u521B\u5EFA\u5B57\u6BB5\u5931\u8D25: ${m.label}`,v);continue}i.set(c,w)}return i}async function ae(t,n,i){switch(i){case 1:return await t.addField({type:1,name:n,property:{}});case 2:return await t.addField({type:2,name:n,property:{}});case 3:return await t.addField({type:3,name:n,property:{options:[{name:"\u56FE\u6587\u7B14\u8BB0"},{name:"\u89C6\u9891\u7B14\u8BB0"}]}});case 4:return await t.addField({type:4,name:n,property:{options:[]}});case 15:return await t.addField({type:15,name:n,property:{}});case 17:return await t.addField({type:17,name:n,property:{}});default:throw new Error(`\u4E0D\u652F\u6301\u7684\u5B57\u6BB5\u7C7B\u578B: ${i}`)}}async function J(t,n,i,h,d){var c,m,w,v;try{const b={},E={singleSelect:new Map,multiSelect:new Map,attachment:new Map,dateTime:new Map};for(const[B,T]of h.entries()){const f=te.find(M=>M.key===B);if(!f)continue;let y=null;switch(B){case"noteId":y=i.id||"";break;case"authorNickname":y=((c=i.user)==null?void 0:c.nickname)||"";break;case"authorRedId":y=((m=i.user)==null?void 0:m.redId)||((w=d==null?void 0:d.basicInfo)==null?void 0:w.redId)||"";break;case"bloggerHomepage":y=((v=d==null?void 0:d.detailedInfo)==null?void 0:v.shareLink)||"";break;case"sticky":const M=i.sticky===!0?"\u7F6E\u9876\u7B14\u8BB0":"\u666E\u901A\u7B14\u8BB0";E.singleSelect.set(T,M);continue;case"type":const I=String(i.type==="video"?"\u89C6\u9891\u7B14\u8BB0":"\u56FE\u6587\u7B14\u8BB0");E.singleSelect.set(T,I);continue;case"title":y=i.title||i.displayTitle||"";break;case"description":let S=i.desc||"";S=S.replace(/#[^\[#\]]+(?:\[话题\])?#/g,"").trim(),S=S.replace(/\s+/g," ").trim(),y=S;break;case"imageAttachments":let k=[];if(i.imageList&&Array.isArray(i.imageList)?k=i.imageList.map(C=>String(C.imageUrl||C||"")).filter(C=>C):i.imagesList&&Array.isArray(i.imagesList)?k=i.imagesList.map(C=>String(C.imageUrl||C||"")).filter(C=>C):typeof i.cover=="string"&&(k=[i.cover]),k.length>0){const C=await re(k);C.length>0&&E.attachment.set(T,C)}continue;case"tags":let L=[];if(i.tags&&Array.isArray(i.tags)&&i.tags.length>0)L=i.tags;else{const O=(i.desc||"").match(/#([^\[#\]]+)(?:\[话题\])?#/g);O&&O.length>0&&(L=O.map(_=>_.replace(/^#/,"").replace(/#$/,"").replace(/\[话题\]/g,"").trim()).filter(_=>_))}L.length>0&&E.multiSelect.set(T,L);continue;case"likes":y=i.likedCount||0;break;case"collects":y=i.collectedCount||0;break;case"shares":y=i.shareCount||i.sharedCount||0;break;case"comments":y=i.commentsCount||0;break;case"videoUrl":y=i.videoUrl||"";break;case"videoDuration":y=i.duration||0;break;case"videoSubtitle":i.subtitleUrl&&(y=await se(i.subtitleUrl));break;case"videoText":i.subtitleUrl&&(y=await ie(i.subtitleUrl));break;case"publishTime":y=i.createTimeStr||i.createTime||"";break;case"fetchTime":y=new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-");break;case"source":d?y="\u535A\u4E3B\u4E3B\u9875\u83B7\u53D6":y="\u5B8C\u6574\u6570\u636E\u83B7\u53D6";break}if(y!=null)switch(f.type){case 1:b[T]=String(y||"");break;case 2:b[T]=Number(y)||0;break;case 15:b[T]=String(y||"");break}}Object.keys(b).length>0&&await t.setRecord(n,{fields:b});for(const[B,T]of E.singleSelect.entries())try{const f=await t.getField(B),y=await f.getOptions(),M=String(T||"");let I=null;const S=y.find(k=>k.name===M);if(S)I=S.id;else{await f.addOptions([{name:M}]);const L=(await f.getOptions()).find(N=>N.name===M);L&&(I=L.id)}I&&await f.setValue(n,I)}catch(f){console.error(`\u8BBE\u7F6E\u5355\u9009\u5B57\u6BB5\u5931\u8D25: ${B}`,f)}for(const[B,T]of E.multiSelect.entries())try{const f=await t.getField(B),y=await f.getOptions(),M=T.map(k=>String(k||"")).filter(k=>k);if(M.length===0)continue;const I=y.map(k=>k.name),S=M.filter(k=>!I.includes(k));if(S.length>0){const k=S.map(C=>({name:C}));await f.addOptions(k);const N=(await f.getOptions()).filter(C=>M.includes(C.name)).map(C=>C.id);await f.setValue(n,N)}else if(M.length>0){const k=y.filter(L=>M.includes(L.name)).map(L=>L.id);await f.setValue(n,k)}else await f.setValue(n,[])}catch(f){console.error(`\u8BBE\u7F6E\u591A\u9009\u5B57\u6BB5\u5931\u8D25: ${B}`,f)}for(const[B,T]of E.attachment.entries())try{await(await t.getField(B)).setValue(n,T)}catch(f){console.error(`\u8BBE\u7F6E\u9644\u4EF6\u5B57\u6BB5\u5931\u8D25: ${B}`,f)}for(const[B,T]of E.dateTime.entries())try{const f=await t.getField(B);await f.setDateFormat(Pe.DATE_TIME),await f.setValue(n,T)}catch(f){console.error(`\u8BBE\u7F6E\u65E5\u671F\u65F6\u95F4\u5B57\u6BB5\u5931\u8D25: ${B}`,f)}}catch(b){throw console.error("\u5199\u5165\u6570\u636E\u5230\u8BB0\u5F55\u5931\u8D25:",b),b}}async function se(t){try{const n=await fetch(t);return n.ok?await n.text():""}catch(n){return console.error("\u83B7\u53D6\u539F\u59CB\u5B57\u5E55\u5931\u8D25:",n),""}}async function ie(t){try{const n=await fetch(t);if(!n.ok)return"";const h=(await n.text()).split(`
`),d=[];for(const c of h){const m=c.trim();!m||/^\d{2}:\d{2}:\d{2},\d{3}\s*-->\s*\d{2}:\d{2}:\d{2},\d{3}$/.test(m)||/^\d+$/.test(m)||d.push(m)}return d.join(`
`)}catch(n){return console.error("\u83B7\u53D6\u5B57\u5E55\u5931\u8D25:",n),""}}async function re(t,n){const i=[];for(let h=0;h<t.length;h++){const d=t[h];try{n&&n(h+1,t.length,`\u4E0B\u8F7D\u56FE\u7247 ${h+1}/${t.length}`);const c=await Be(d);i.push(...c),h<t.length-1&&await new Promise(m=>setTimeout(m,200))}catch(c){console.error(`\u4E0B\u8F7D\u56FE\u7247\u5931\u8D25: ${d}`,c)}}return i}async function Be(t){try{let n=t;t.startsWith("http://")&&(n=t.replace("http://","https://"));const i=await fetch(n,{method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!i.ok)return console.error(`\u4E0B\u8F7D\u5931\u8D25\uFF0CHTTP\u72B6\u6001\u7801: ${i.status}, URL: ${n}`),[];const h=await i.blob(),d=h.type.split("/")[1]||"jpg",c=`image_${Date.now()}.${d}`;return[new File([h],c,{type:h.type})]}catch(n){return console.error(`\u4E0B\u8F7D\u9644\u4EF6\u5931\u8D25: ${t}`,n),[]}}e("#existingTableSelect").on("change",async function(){await fe()}),e("#selectAllFields").on("click",function(){e('#fieldSelectionContainer input[type="checkbox"]').prop("checked",!0)}),e("#deselectAllFields").on("click",function(){e('#fieldSelectionContainer input[type="checkbox"]').prop("checked",!1)}),e("#languageToggle").on("click",function(){const n=s.language==="zh"?"en":"zh";s.changeLanguage(n,(i,h)=>{if(i)return console.error("Failed to change language:",i);ce(),e("#currentLanguage").text(n==="zh"?"\u4E2D\u6587":"English"),localStorage.setItem("preferred_language",n),Q()})});const Y=localStorage.getItem("preferred_language");Y&&["zh","en"].includes(Y)&&s.changeLanguage(Y,(t,n)=>{if(t)return console.error("Failed to restore language:",t);ce(),e("#currentLanguage").text(Y==="zh"?"\u4E2D\u6587":"English")});const V="https://shop.leshangyundian.com/feishu/api/blogger-check";let le=[],X=null,R=[];async function Z(){try{const t=localStorage.getItem("xhsnote_token");if(!t){u(s.t("messages.pleaseLoginFirst"),"error");return}const i=await(await fetch(`${V}/list`,{method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).json();i.success===!0&&i.data?(le=i.data.records||[],ke()):u(i.message||"\u52A0\u8F7D\u5931\u8D25","error")}catch{u(s.t("messages.loadTableListFailed"),"error")}}function ke(){const t=e("#pushSettingsList"),n=e("#pushSettingsEmpty");if(t.find(".push-setting-item").remove(),le.length===0){n.show();return}n.hide(),le.forEach(i=>{const h=Te(i);t.append(h)})}function Te(t){const n=document.createElement("div");n.className="push-setting-item",n.style.cssText=`
      margin-bottom: 16px;
      padding: 20px;
      background: white;
      border-radius: 12px;
      border: 1px solid #e8e8e8;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      display: flex;
      align-items: flex-start;
      gap: 20px;
      transition: all 0.3s ease;
    `,n.onmouseover=()=>{n.style.boxShadow="0 4px 16px rgba(0, 0, 0, 0.08)",n.style.transform="translateY(-2px)"},n.onmouseout=()=>{n.style.boxShadow="0 2px 8px rgba(0, 0, 0, 0.04)",n.style.transform="translateY(0)"};const i=Fe(t.timeConfigType,t.checkTime),h=t.lastExecuteTime?new Date(t.lastExecuteTime).toLocaleString("zh-CN"):"-",d=t.isEnabled===1,c=d?"linear-gradient(135deg, #52c41a 0%, #73d13d 100%)":"linear-gradient(135deg, #999 0%, #bfbfbf 100%)",m=d?s.t("pushSettings.enabled"):s.t("pushSettings.disabled");n.innerHTML=`
      <div style="flex: 1; min-width: 0;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <div style="font-size: 16px; font-weight: 600; color: #1a1a1a;">
            ${t.bloggerNickname||s.t("pushSettings.blogger")}
          </div>
          <div style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; background: ${c}; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            ${m}
          </div>
        </div>
        <div style="display: flex; flex-direction: column; gap: 8px; font-size: 13px; color: #666;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="display: flex; align-items: center; gap: 6px; min-width: 80px;">
              <svg width="14" height="14" fill="none" stroke="#ff4d4f" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <span style="color: #999; font-weight: 500;">${s.t("pushSettings.bloggerId")}:</span>
            </div>
            <span style="font-family: 'Consolas', 'Monaco', monospace; color: #333; background: #f5f5f5; padding: 2px 8px; border-radius: 4px; max-width: 350px; display: inline-block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${t.bloggerUrl}">${t.bloggerUrl}</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="display: flex; align-items: center; gap: 6px; min-width: 80px;">
              <svg width="14" height="14" fill="none" stroke="#1890ff" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span style="color: #999; font-weight: 500;">${s.t("pushSettings.scheduleTime")}:</span>
            </div>
            <span style="color: #1890ff; font-weight: 500; background: #e6f7ff; padding: 2px 8px; border-radius: 4px;">${i}</span>
          </div>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="display: flex; align-items: center; gap: 6px; min-width: 80px;">
              <svg width="14" height="14" fill="none" stroke="#52c41a" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span style="color: #999; font-weight: 500;">${s.t("pushSettings.lastUpdateTime")}:</span>
            </div>
            <span style="color: #666;">${h}</span>
          </div>
        </div>
      </div>
      <div style="display: flex; gap: 8px; flex-shrink: 0;">
        <button class="button-edit" data-id="${t.id}" style="
          padding: 8px 16px;
          font-size: 13px;
          font-weight: 500;
          background: white;
          border: 1px solid #d9d9d9;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.3s;
          color: #333;
          display: flex;
          align-items: center;
          gap: 4px;
        ">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
          </svg>
          ${s.t("pushSettings.edit")}
        </button>
        <button class="button-toggle" data-id="${t.id}" data-enabled="${t.isEnabled}" style="
          padding: 8px 16px;
          font-size: 13px;
          font-weight: 500;
          background: ${d?"#fff1f0":"#f6ffed"};
          border: 1px solid ${d?"#ffccc7":"#b7eb8f"};
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.3s;
          color: ${d?"#ff4d4f":"#52c41a"};
          display: flex;
          align-items: center;
          gap: 4px;
        ">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${d?"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636":"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"}"></path>
          </svg>
          ${d?s.t("pushSettings.disable"):s.t("pushSettings.enable")}
        </button>
        <button class="button-delete" data-id="${t.id}" style="
          padding: 8px 16px;
          font-size: 13px;
          font-weight: 500;
          background: white;
          border: 1px solid #ff4d4f;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.3s;
          color: #ff4d4f;
          display: flex;
          align-items: center;
          gap: 4px;
        ">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
          </svg>
          ${s.t("pushSettings.delete")}
        </button>
      </div>
    `;const w=n.querySelector(".button-edit"),v=n.querySelector(".button-toggle"),b=n.querySelector(".button-delete");return w.onclick=()=>Se(t.id),v.onclick=()=>Ce(t.id,t.isEnabled),b.onclick=()=>Ae(t.id),w.onmouseover=()=>{w.style.borderColor="#1890ff",w.style.color="#1890ff",w.style.background="#e6f7ff"},w.onmouseout=()=>{w.style.borderColor="#d9d9d9",w.style.color="#333",w.style.background="white"},v.onmouseover=()=>{t.isEnabled,v.style.transform="scale(1.05)",v.style.boxShadow="0 2px 8px rgba(0,0,0,0.15)"},v.onmouseout=()=>{v.style.transform="scale(1)",v.style.boxShadow="none"},b.onmouseover=()=>{b.style.background="#ff4d4f",b.style.color="white",b.style.transform="scale(1.05)"},b.onmouseout=()=>{b.style.background="white",b.style.color="#ff4d4f",b.style.transform="scale(1)"},n}function Fe(t,n){try{switch(t){case"fixed":return JSON.parse(n).join(", ");case"interval":return`${s.t("pushSettings.modal.timeType.interval")}: ${n}${s.t("recharge.days")}`;case"cron":return`${s.t("pushSettings.modal.timeType.cron")}: ${n}`;default:return n}}catch{return n}}async function he(){try{const t=await D.base.getTableMetaList(),n=e("#pushSettingTableSelect"),i=n.val();n.empty().append('<option value="">\u8BF7\u9009\u62E9\u8868\u683C</option>'),t.forEach(c=>{const m=e("<option></option>").val(c.id).text(c.name);n.append(m)});const h=await D.base.getSelection(),d=(h==null?void 0:h.baseId)||"";e("#pushSettingAppTokenValue").text(d||"-"),i&&n.val(i)}catch{u("\u52A0\u8F7D\u8868\u683C\u5217\u8868\u5931\u8D25","error")}}async function Ie(){X=null,R=[],await he(),e("#pushSettingId").val(""),e("#pushSettingTableSelect").val(""),e("#pushSettingPersonalBaseToken").val(""),e("#pushSettingBloggerUrl").val(""),e("#pushSettingBloggerNickname").val(""),e("#pushSettingTimeConfigType").val("fixed"),e("#checkTimeIntervalInput").val(""),e("#pushSettingEnableRandomDelay").prop("checked",!0),e("#pushSettingRandomDelayMin").val("10"),e("#pushSettingRandomDelayMax").val("100"),e("#pushSettingIsEnabled").prop("checked",!0),e("#checkTimeFixedList").empty(),e("#addModeTableSelection").show(),e("#editModeTableInfo").hide(),e("#pushSettingModalTitle").text(s.t("pushSettings.modal.title")),ue(),e("#pushSettingModal").css("display","flex")}async function Se(t){try{const n=localStorage.getItem("xhsnote_token");if(!n){u(s.t("messages.pleaseLoginFirst"),"error");return}const h=await(await fetch(`${V}/edit/${t}`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).json();if(h.success===!0&&h.data){const d=h.data;if(X=t,await he(),e("#pushSettingId").val(d.id),e("#pushSettingPersonalBaseToken").val(d.personalBaseToken||""),e("#pushSettingBloggerUrl").val(d.bloggerUrl),e("#pushSettingBloggerNickname").val(d.bloggerNickname||""),e("#pushSettingTimeConfigType").val(d.timeConfigType),e("#pushSettingEnableRandomDelay").prop("checked",d.enableRandomDelay===1),e("#pushSettingRandomDelayMin").val(d.randomDelayMin||10),e("#pushSettingRandomDelayMax").val(d.randomDelayMax||100),e("#pushSettingIsEnabled").prop("checked",d.isEnabled===1),d.timeConfigType==="fixed"){try{R=JSON.parse(d.checkTime)}catch{R=[]}ee()}else d.timeConfigType==="interval"&&e("#checkTimeIntervalInput").val(d.checkTime);const m=(await D.base.getTableMetaList()).find(b=>b.id===d.tableId),w=m?m.name:d.tableId,v=d.appToken||await D.base.getSelection().then(b=>(b==null?void 0:b.baseId)||"");e("#editModeTableName").text(w),e("#editModeTableId").text(d.tableId),e("#editModeTableLink").attr("href",`https://feishu.cn/base/${v}?table=${d.tableId}`),e("#addModeTableSelection").hide(),e("#editModeTableInfo").show(),e("#pushSettingModalTitle").text(s.t("pushSettings.modal.editTitle")),ue(),e("#pushSettingModal").css("display","flex")}else u(h.message||"\u83B7\u53D6\u8BE6\u60C5\u5931\u8D25","error")}catch{u(s.t("messages.loadTableListFailed"),"error")}}window.closePushSettingModal=function(){e("#pushSettingModal").hide(),X=null,R=[]};function ue(){const t=e("#pushSettingTimeConfigType").val();switch(e("#checkTimeFixedContainer").hide(),e("#checkTimeIntervalContainer").hide(),t){case"fixed":e("#checkTimeFixedContainer").show(),ee();break;case"interval":e("#checkTimeIntervalContainer").show();break}}function ee(){const t=e("#checkTimeFixedList");t.empty(),R.forEach((n,i)=>{const h=document.createElement("div");h.style.cssText="display: flex; align-items: center; gap: 8px;",h.innerHTML=`
        <input type="time" value="${n}" class="fixed-time-input" data-index="${i}" style="
          padding: 6px 8px;
          border: 1px solid #d9d9d9;
          border-radius: 4px;
          font-size: 14px;
        ">
        <button type="button" class="remove-time-btn" data-index="${i}" style="
          padding: 4px 8px;
          font-size: 12px;
          background: #fff1f0;
          border: 1px solid #ffccc7;
          border-radius: 4px;
          cursor: pointer;
          color: #ff4d4f;
        ">\xD7</button>
      `,t.append(h)}),t.find(".fixed-time-input").on("change",function(){const n=parseInt(e(this).data("index"));R[n]=e(this).val()}),t.find(".remove-time-btn").on("click",function(){const n=parseInt(e(this).data("index"));R.splice(n,1),ee()})}function Ee(){R.push("09:00"),ee()}window.savePushSetting=async function(){try{const t=e("#pushSettingBloggerUrl").val(),n=e("#pushSettingBloggerNickname").val(),i=e("#pushSettingTimeConfigType").val(),h=e("#pushSettingEnableRandomDelay").prop("checked")?1:0,d=parseInt(e("#pushSettingRandomDelayMin").val())||10,c=parseInt(e("#pushSettingRandomDelayMax").val())||100,m=e("#pushSettingIsEnabled").prop("checked")?1:0;let w;switch(i){case"fixed":if(R.length===0){u("\u8BF7\u81F3\u5C11\u6DFB\u52A0\u4E00\u4E2A\u65F6\u95F4\u70B9","error");return}w=JSON.stringify(R);break;case"interval":if(w=e("#checkTimeIntervalInput").val(),!w||parseInt(w)<=0){u("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u95F4\u9694\u5206\u949F\u6570","error");return}break;default:u("\u8BF7\u9009\u62E9\u65F6\u95F4\u914D\u7F6E\u7C7B\u578B","error");return}const v=localStorage.getItem("xhsnote_token");if(!v){u(s.t("messages.pleaseLoginFirst"),"error");return}const b=await D.base.getSelection(),E=(b==null?void 0:b.baseId)||"";if(!E){u("\u65E0\u6CD5\u83B7\u53D6Base ID","error");return}let B;if(X)B=e("#pushSettingTableSelect").val();else if(B=e("#pushSettingTableSelect").val(),!B){u("\u8BF7\u9009\u62E9\u63A8\u9001\u8868\u683C","error");return}const T=e("#pushSettingPersonalBaseToken").val();if(!T){u("\u8BF7\u8F93\u5165Personal Base Token","error");return}const f={tableId:B,appToken:E,personalBaseToken:T,bloggerUrl:t,timeConfigType:i,checkTime:w,enableRandomDelay:h,randomDelayMin:d,randomDelayMax:c,isEnabled:m};n&&(f.bloggerNickname=n),X&&(f.id=X);const y=X?`${V}/update`:`${V}/create`,I=await(await fetch(y,{method:X?"PUT":"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify(f)})).json();I.success===!0&&I.data.success?(u(X?s.t("messages.updateSuccess"):s.t("messages.saveSuccess"),"success"),window.closePushSettingModal(),await Z()):u(I.message||"\u4FDD\u5B58\u5931\u8D25","error")}catch{u(s.t("messages.saveFailed"),"error")}};async function Ce(t,n){try{const i=localStorage.getItem("xhsnote_token");if(!i){u(s.t("messages.pleaseLoginFirst"),"error");return}const c=await(await fetch(`${V}/toggle/${t}?isEnabled=${n===1?0:1}`,{method:"PUT",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).json();c.success===!0&&c.data.success?(u(c.data.message,"success"),await Z()):u(c.message||"\u64CD\u4F5C\u5931\u8D25","error")}catch{u(s.t("messages.updateFailed"),"error")}}async function De(t){try{const n=localStorage.getItem("xhsnote_token");if(!n){u(s.t("messages.pleaseLoginFirst"),"error");return}const h=await(await fetch(`${V}/delete/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}})).json();h.success===!0&&h.data.success?(u(s.t("messages.unbindSuccess"),"success"),await Z()):u(h.message||"\u5220\u9664\u5931\u8D25","error")}catch{u(s.t("messages.unbindFailed"),"error")}}function Ae(t){confirm(s.t("pushSettings.confirmDelete"))&&De(t)}e("#addPushSettingBtn").on("click",Ie),e("#pushSettingTimeConfigType").on("change",ue),e("#addCheckTimeBtn").on("click",Ee),e("#tabAutoPush").on("click",async function(){await Z()})});
